# .env.testing セットアップガイド

## 概要

`.env.testing` ファイルは、テスト実行時に使用される環境変数を定義します。

**重要**: `.env.testing` ファイルには機密情報（APP_KEY等）が含まれるため、Git には含めません。

---

## セットアップ手順

### 1. .env.testing ファイルを作成

```bash
cd backend
cp .env.testing.example .env.testing
```

### 2. APP_KEY を生成

```bash
# Dockerコンテナ内で実行
docker compose exec backend php artisan key:generate --env=testing

# または、ローカルで実行
php artisan key:generate --env=testing
```

これにより、`.env.testing` ファイルに自動的に APP_KEY が設定されます。

### 3. 設定を確認

```bash
cat .env.testing
```

APP_KEY が以下の形式で設定されていることを確認：
```
APP_KEY=base64:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx=
```

---

## セキュリティに関する注意事項

### ❌ やってはいけないこと

1. **APP_KEY を Git にコミットしない**
   - `.env.testing` は `.gitignore` に含まれています
   - `phpunit.xml` に APP_KEY を直接記載しない

2. **本番環境の APP_KEY を使用しない**
   - テスト環境専用の APP_KEY を生成する
   - 本番環境の `.env` から APP_KEY をコピーしない

3. **APP_KEY を共有しない**
   - チーム内でも APP_KEY は共有しない
   - 各開発者が自分で生成する

### ✅ 推奨される運用

1. **開発者ごとに生成**
   - 各開発者が自分の環境で `php artisan key:generate --env=testing` を実行

2. **CI/CD 環境での設定**
   - GitHub Actions 等では、Secrets に APP_KEY を設定
   - ビルド時に動的に生成してもよい

---

## トラブルシューティング

### エラー: "No application encryption key has been specified."

**原因**: `.env.testing` ファイルに APP_KEY が設定されていない

**解決方法**:
```bash
docker compose exec backend php artisan key:generate --env=testing
```

### エラー: ".env.testing file not found"

**原因**: `.env.testing` ファイルが存在しない

**解決方法**:
```bash
cp .env.testing.example .env.testing
docker compose exec backend php artisan key:generate --env=testing
```

---

## 参考

- [Laravel - Configuration](https://laravel.com/docs/11.x/configuration)
- [Laravel - Encryption](https://laravel.com/docs/11.x/encryption)
