# UC-001-004: 職員アカウント編集

最終更新: 2025-12-26

---

## 基本情報

| 項目 | 値 |
|------|-----|
| ユースケースID | UC-001-004 |
| ユースケース名 | 職員アカウント編集 |
| アクター | 管理者 |
| 関連Epic | - |
| 関連課題 | - |
| ステータス | Planned |

---

## 概要

管理者が既存の職員アカウント情報を編集する。氏名、メールアドレス、権限の変更、およびパスワードのリセットが可能。

---

## 事前条件

- 管理者がシステムにログイン済みであること
- 管理者権限を持っていること
- 編集対象の職員アカウントが存在すること

---

## 事後条件

- 職員アカウント情報が更新される
- 変更履歴が記録される
- パスワードリセット時は次回ログイン時にパスワード変更を強制する

---

## 基本フロー

1. 管理者が職員アカウント管理画面を開く
2. 管理者が編集対象の職員を選択する
3. システムが職員情報編集フォームを表示する
4. 管理者が職員情報を編集する
5. 管理者が「保存」ボタンをクリックする
6. システムが入力内容を検証する
7. システムが職員アカウント情報を更新する
8. システムが職員一覧画面にリダイレクトする
9. システムが「職員情報を更新しました」と表示する

---

## 代替フロー

### 4a. パスワードをリセットする場合

1. 管理者が「パスワードをリセット」ボタンをクリックする
2. システムが確認ダイアログを表示する
3. 管理者が「リセット」をクリックする
4. システムが新しいランダムパスワードを生成する
5. システムが「パスワード変更必須」フラグを設定する
6. 基本フロー7に進む

### 6a. メールアドレスが既に登録されている場合

1. システムが「このメールアドレスは既に登録されています」とエラーを表示する
2. 管理者がメールアドレスを修正する
3. 基本フロー5に戻る

### 6b. 必須項目が未入力の場合

1. システムが未入力項目にエラーを表示する
2. 管理者が必須項目を入力する
3. 基本フロー5に戻る

### 2a. 編集対象が自分自身の場合

1. システムが「自分自身の権限は変更できません」と表示する
2. 権限変更フィールドを無効化する

---

## ビジネスルール

| ルールID | ルール内容 |
|----------|-----------|
| BR-UC001-04-01 | メールアドレスはシステム内で一意であること |
| BR-UC001-04-02 | 管理者は自分自身の管理者権限を変更できない |
| BR-UC001-04-03 | パスワードリセット時は次回ログインでパスワード変更を強制 |
| BR-UC001-04-04 | 最後の管理者アカウントの権限を一般職員に変更できない |
| BR-UC001-04-05 | 変更操作は監査ログに記録される |

---

## 非機能要件

| 項目 | 要件 |
|------|------|
| パフォーマンス | 情報更新は3秒以内に完了する |
| セキュリティ | リセットパスワードは暗号化して保存 |
| 監査 | アカウント編集操作をログに記録する |
| 整合性 | 同時編集時は楽観的ロックで競合を検出 |

---

## 画面イメージ（概要）

### 編集フォーム
- 氏名（必須）
- メールアドレス（必須）
- 権限選択（一般職員/管理者）
- パスワードリセットボタン

### ボタン
- 保存ボタン
- キャンセルボタン
- パスワードリセットボタン

---

## 入力項目

| 項目 | 必須 | 形式 | 備考 |
|------|:----:|------|------|
| 氏名 | ○ | 文字列（50文字以内） | 姓名をスペース区切り |
| メールアドレス | ○ | メール形式 | 一意制約あり |
| 権限 | ○ | 選択 | 一般職員/管理者 |

---

## 関連ユースケース

| ユースケース | 関係 |
|-------------|------|
| UC-001-002_職員ダッシュボード表示 | 管理メニューから遷移 |
| UC-001-003_職員アカウント作成 | 作成後の編集 |
| UC-001-005_職員アカウント無効化 | 編集画面から無効化 |

---

## 技術実装メモ

- API エンドポイント: PUT /api/staff/accounts/{id}
- パスワードリセット: POST /api/staff/accounts/{id}/reset-password
- 楽観的ロック: updated_at カラムで競合検出
- 監査ログ: security チャンネルに記録

---

## 関連ドキュメント

- [セキュリティ標準 - パスワードポリシー](../../../../00_docs/20_tech/99_standard/security/01_PasswordPolicy.md)
