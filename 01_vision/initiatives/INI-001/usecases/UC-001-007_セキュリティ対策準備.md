# UC-001-007: セキュリティ対策準備

最終更新: 2024-04-22

---

## 概要

開発環境およびアプリケーションに対して、セキュリティ標準に基づいたセキュリティ対策を準備・実装する。パスワードポリシー、セッション管理、暗号化設定、脆弱性スキャン体制を整備し、安全な開発・運用基盤を構築する。

---

## アクター

| アクター | 役割 |
|----------|------|
| 開発者 | セキュリティ設定を実装する |
| セキュリティ担当 | セキュリティ標準の遵守を確認する |

---

## 事前条件

- Docker 環境が構築済みであること（UC-000-001）
- バックエンド初期設定が完了していること（UC-000-002）
- フロントエンド初期設定が完了していること（UC-000-003）
- 認証機能が実装済みであること（UC-001-001, UC-001-006）

---

## 基本フロー

1. 開発者がセキュリティ標準ドキュメントを確認する
2. 開発者がパスワードポリシーを実装する（AuthServiceProvider）
3. 開発者がセッション管理設定を実装する（config/session.php）
4. 開発者が暗号化設定を確認・調整する（config/hashing.php）
5. 開発者がセキュリティスキャンツールを設定する
6. 開発者が脆弱性スキャンを実行し、結果を確認する
7. セキュリティ担当がセキュリティ設定をレビューする

---

## 代替フロー

### A1: 脆弱性が検出された場合

1. システムが脆弱性レポートを出力する
2. 開発者が脆弱性の重大度を評価する
3. 開発者が脆弱性管理プロセスに従って修正を行う
4. 開発者が再スキャンで修正を確認する

### A2: 依存関係に脆弱性がある場合

1. `composer audit` または `npm audit` が脆弱性を検出する
2. 開発者がサードパーティセキュリティポリシーに従って対応を判断する
3. 開発者がパッケージを更新、または緩和策を実施する

---

## 事後条件

- パスワードポリシーが実装されている（12文字以上、複雑性要件）
- セッション管理が適切に設定されている（タイムアウト、同時ログイン制御）
- 暗号化設定が標準に準拠している（bcrypt/Argon2id）
- セキュリティスキャンが実行可能な状態である
- 既知の Critical/High 脆弱性が解消されている

---

## 実装対象

### 1. パスワードポリシー

| 項目 | 設定値 | 参照ドキュメント |
|------|--------|-----------------|
| 最小文字数 | 12文字 | 01_PasswordPolicy.md |
| 複雑性 | 英大小文字・数字・記号必須 | 01_PasswordPolicy.md |
| 漏洩チェック | Have I Been Pwned API | 01_PasswordPolicy.md |
| 履歴 | 過去5世代の再利用禁止 | 01_PasswordPolicy.md |

### 2. セッション管理

| 項目 | 設定値 | 参照ドキュメント |
|------|--------|-----------------|
| アイドルタイムアウト | 30分 | 02_SessionManagement.md |
| 絶対タイムアウト | 8時間 | 02_SessionManagement.md |
| 同時ログイン | 最大3台 | 02_SessionManagement.md |
| Cookie属性 | Secure, HttpOnly, SameSite | 02_SessionManagement.md |

### 3. 暗号化設定

| 項目 | 設定値 | 参照ドキュメント |
|------|--------|-----------------|
| パスワードハッシュ | bcrypt (cost=12) または Argon2id | 04_EncryptionPolicy.md |
| 通信暗号化 | TLS 1.2以上 | 04_EncryptionPolicy.md |
| セッション暗号化 | 有効 | 04_EncryptionPolicy.md |

### 4. セキュリティスキャン

| ツール | 対象 | 頻度 | 参照ドキュメント |
|-------|------|------|-----------------|
| composer audit | PHP 依存関係 | CI/CD 毎 | 08_SecurityScanning.md |
| npm audit | JS 依存関係 | CI/CD 毎 | 08_SecurityScanning.md |
| PHPStan/Larastan | PHP コード | CI/CD 毎 | 08_SecurityScanning.md |
| OWASP ZAP | 実行中アプリ | 週次 | 08_SecurityScanning.md |

---

## 成果物

| 成果物 | 配置場所 |
|--------|---------|
| パスワードバリデーション設定 | app/Providers/AuthServiceProvider.php |
| セッション設定 | config/session.php |
| ハッシュ設定 | config/hashing.php |
| セキュリティスキャン設定 | Makefile, .github/workflows/ |
| セキュリティスキャンレポート | reports/security/ |

---

## 参照セキュリティ標準

| No. | ドキュメント | 内容 |
|:---:|-------------|------|
| 01 | [01_PasswordPolicy.md](../../../../00_docs/20_tech/99_standard/security/01_PasswordPolicy.md) | パスワードポリシー |
| 02 | [02_SessionManagement.md](../../../../00_docs/20_tech/99_standard/security/02_SessionManagement.md) | セッション管理ポリシー |
| 03 | [03_DataClassification.md](../../../../00_docs/20_tech/99_standard/security/03_DataClassification.md) | データ分類・保護ポリシー |
| 04 | [04_EncryptionPolicy.md](../../../../00_docs/20_tech/99_standard/security/04_EncryptionPolicy.md) | 暗号化ポリシー |
| 05 | [05_IncidentResponse.md](../../../../00_docs/20_tech/99_standard/security/05_IncidentResponse.md) | インシデント対応手順 |
| 06 | [06_VulnerabilityManagement.md](../../../../00_docs/20_tech/99_standard/security/06_VulnerabilityManagement.md) | 脆弱性管理プロセス |
| 07 | [07_ThirdPartySecurity.md](../../../../00_docs/20_tech/99_standard/security/07_ThirdPartySecurity.md) | サードパーティセキュリティ |
| 08 | [08_SecurityScanning.md](../../../../00_docs/20_tech/99_standard/security/08_SecurityScanning.md) | セキュリティスキャンガイド |

---

## 関連 Use Case

| ID | Use Case 名 | 関係 |
|----|-------------|------|
| UC-000-001 | Docker 環境構築 | 前提条件 |
| UC-000-002 | バックエンド初期設定 | 前提条件 |
| UC-001-001 | 職員ログイン | セキュリティ設定の適用対象 |
| UC-001-006 | 職員ログアウト | セキュリティ設定の適用対象 |
