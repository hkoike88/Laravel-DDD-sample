# UC-001-010: 利用者アカウント無効化

最終更新: 2024-04-22

---

## 基本情報

| 項目 | 値 |
|------|-----|
| ユースケースID | UC-001-010 |
| ユースケース名 | 利用者アカウント無効化 |
| アクター | 図書館職員 |
| 関連Epic | - |
| 関連課題 | - |
| ステータス | Planned |

---

## 概要

図書館職員が利用者アカウントを無効化する。転出、死亡、規約違反などの理由により、利用者の貸出機能を停止する。

---

## 事前条件

- 職員がシステムにログイン済みであること
- 無効化対象の利用者がシステムに登録済みであること
- 対象利用者に未返却の図書がないこと（警告表示）

---

## 事後条件

- 利用者アカウントが無効化される
- 貸出カードが無効になる
- 無効化理由と日時が記録される
- 利用者は新規の貸出ができなくなる

---

## 基本フロー

1. 職員が利用者検索画面で対象利用者を検索する
2. 職員が検索結果から対象利用者を選択する
3. システムが利用者詳細画面を表示する
4. 職員が「無効化」ボタンをクリックする
5. システムが無効化確認ダイアログを表示する
6. システムが未返却図書の有無を確認する
7. 職員が無効化理由を選択・入力する
   - 転出
   - 本人希望
   - 有効期限切れ（長期未更新）
   - 規約違反
   - その他（自由記述）
8. 職員が「確認」ボタンをクリックする
9. システムが利用者アカウントを無効化する
10. システムが無効化日時と理由を記録する
11. システムが利用者一覧画面に戻る
12. システムが「利用者アカウントを無効化しました」と表示する

---

## 代替フロー

### 6a. 未返却図書がある場合

1. システムが「未返却図書があります」と警告を表示する
2. システムが未返却図書の一覧を表示する
3. 職員が返却処理を先に行うか判断する
4. 職員が「未返却のまま無効化」を選択した場合、基本フロー7に戻る
5. 職員がキャンセルした場合、基本フロー3に戻る

### 8a. 職員が無効化をキャンセルする場合

1. 職員が「キャンセル」ボタンをクリックする
2. システムが利用者詳細画面に戻る

---

## ビジネスルール

| ルールID | ルール内容 |
|----------|-----------|
| BR-UC001-10-01 | 無効化された利用者は新規貸出不可 |
| BR-UC001-10-02 | 無効化しても利用者データは削除しない（論理削除） |
| BR-UC001-10-03 | 未返却図書がある場合は警告を表示する |
| BR-UC001-10-04 | 無効化理由は必須 |
| BR-UC001-10-05 | 無効化された利用者は再有効化が可能 |

---

## 非機能要件

| 項目 | 要件 |
|------|------|
| パフォーマンス | 無効化処理は2秒以内に完了する |
| セキュリティ | 無効化操作は職員権限が必要 |
| 監査 | 無効化操作をログに記録する |

---

## 画面イメージ（概要）

### 無効化確認ダイアログ

- 利用者情報サマリー
- 未返却図書一覧（該当がある場合）
- 無効化理由選択
- 備考入力欄

### ボタン

- 確認ボタン
- キャンセルボタン

---

## 入力項目

| 項目 | 必須 | 形式 | 備考 |
|------|:----:|------|------|
| 無効化理由 | ○ | 選択 | 転出/本人希望/有効期限切れ/規約違反/その他 |
| 備考 | - | 文字列（500文字以内） | その他選択時は必須 |

---

## 関連ユースケース

| ユースケース | 関係 |
|-------------|------|
| UC-001-008_利用者アカウント登録 | 登録後の無効化 |
| UC-001-009_利用者アカウント編集 | 編集ではなく無効化 |
| UC-001-011_利用者検索 | 無効化対象の検索 |

---

## 技術実装メモ

- API エンドポイント: DELETE /api/patrons/{id}（論理削除）
- ステータス更新: is_active = false
- 無効化記録: patron_deactivation_logs テーブル
- 監査ログ: audit チャンネルに記録

---

## 関連ドキュメント

- [利用者登録・管理業務フロー（AS-IS）](../../../../00_docs/10_business/asis/swimlane/user-registration-process.md)
- [セキュリティ標準 - データ分類・保護ポリシー](../../../../00_docs/20_tech/99_standard/security/03_DataClassification.md)
