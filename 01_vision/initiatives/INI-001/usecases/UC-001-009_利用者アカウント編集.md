# UC-001-009: 利用者アカウント編集

最終更新: 2024-04-22

---

## 基本情報

| 項目 | 値 |
|------|-----|
| ユースケースID | UC-001-009 |
| ユースケース名 | 利用者アカウント編集 |
| アクター | 図書館職員 |
| 関連Epic | - |
| 関連課題 | - |
| ステータス | Planned |

---

## 概要

図書館職員が既存利用者の情報を編集する。住所変更、連絡先変更、有効期限の更新などを行う。

---

## 事前条件

- 職員がシステムにログイン済みであること
- 編集対象の利用者がシステムに登録済みであること

---

## 事後条件

- 利用者情報が更新される
- 変更履歴が記録される

---

## 基本フロー

1. 職員が利用者検索画面で対象利用者を検索する
2. 職員が検索結果から対象利用者を選択する
3. システムが利用者詳細画面を表示する
4. 職員が「編集」ボタンをクリックする
5. システムが編集フォームを表示する
6. 職員が変更したい項目を編集する
7. 職員が「保存」ボタンをクリックする
8. システムが入力内容を検証する
9. システムが利用者情報を更新する
10. システムが変更履歴を記録する
11. システムが利用者詳細画面に戻る
12. システムが「利用者情報を更新しました」と表示する

---

## 代替フロー

### 6a. 有効期限を更新する場合

1. 職員が「有効期限更新」ボタンをクリックする
2. システムが現在日から1年後の日付を有効期限に設定する
3. システムが更新日を記録する
4. 基本フロー7に戻る

### 8a. 必須項目が未入力の場合

1. システムが未入力項目にエラーを表示する
2. 職員が必須項目を入力する
3. 基本フロー7に戻る

### 8b. 住所変更で対象地域外になる場合

1. システムが「対象地域外の住所です」と警告を表示する
2. 職員が通勤・通学先の確認を行う
3. 職員が備考欄を更新する
4. 基本フロー7に戻る

---

## ビジネスルール

| ルールID | ルール内容 |
|----------|-----------|
| BR-UC001-09-01 | 利用者番号は変更不可 |
| BR-UC001-09-02 | 有効期限更新は更新日から1年間 |
| BR-UC001-09-03 | 変更履歴は5年間保存する |
| BR-UC001-09-04 | 住所変更時は本人確認書類の確認が必要（業務ルール） |

---

## 非機能要件

| 項目 | 要件 |
|------|------|
| パフォーマンス | 更新処理は2秒以内に完了する |
| セキュリティ | 個人情報は暗号化して保存 |
| 監査 | 更新操作と変更内容をログに記録する |

---

## 画面イメージ（概要）

### 編集フォーム

- 氏名（必須）
- ふりがな（必須）
- 生年月日（必須）
- 住所（必須）
- 電話番号（必須）
- 利用者区分（必須）
- 備考（任意）
- 有効期限（表示のみ、更新ボタンで延長）

### ボタン

- 保存ボタン
- 有効期限更新ボタン
- キャンセルボタン

---

## 入力項目

| 項目 | 必須 | 形式 | 備考 |
|------|:----:|------|------|
| 氏名 | ○ | 文字列（50文字以内） | 姓名をスペース区切り |
| ふりがな | ○ | ひらがな（50文字以内） | 姓名をスペース区切り |
| 生年月日 | ○ | 日付 | YYYY-MM-DD形式 |
| 住所 | ○ | 文字列（200文字以内） | 郵便番号含む |
| 電話番号 | ○ | 電話番号形式 | 連絡先として使用 |
| 利用者区分 | ○ | 選択 | 一般/学生/児童 |
| 備考 | - | 文字列（500文字以内） | 通勤・通学先など |

---

## 関連ユースケース

| ユースケース | 関係 |
|-------------|------|
| UC-001-008_利用者アカウント登録 | 登録後に編集 |
| UC-001-010_利用者アカウント無効化 | 編集ではなく無効化が必要な場合 |
| UC-001-011_利用者検索 | 編集対象の検索 |

---

## 技術実装メモ

- API エンドポイント: PUT /api/patrons/{id}
- 有効期限更新: POST /api/patrons/{id}/renew
- 変更履歴: patron_histories テーブルに記録
- 監査ログ: audit チャンネルに記録

---

## 関連ドキュメント

- [利用者登録・管理業務フロー（AS-IS）](../../../../00_docs/10_business/asis/swimlane/user-registration-process.md)
- [セキュリティ標準 - データ分類・保護ポリシー](../../../../00_docs/20_tech/99_standard/security/03_DataClassification.md)
