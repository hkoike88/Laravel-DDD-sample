# UC-001-005: 職員アカウント無効化

最終更新: 2025-12-26

---

## 基本情報

| 項目 | 値 |
|------|-----|
| ユースケースID | UC-001-005 |
| ユースケース名 | 職員アカウント無効化 |
| アクター | 管理者 |
| 関連Epic | - |
| 関連課題 | - |
| ステータス | Planned |

---

## 概要

管理者が職員アカウントを無効化する。無効化された職員はシステムにログインできなくなる。データは論理削除として保持され、必要に応じて再有効化が可能。

---

## 事前条件

- 管理者がシステムにログイン済みであること
- 管理者権限を持っていること
- 無効化対象の職員アカウントが存在すること
- 無効化対象の職員アカウントが有効状態であること

---

## 事後条件

- 職員アカウントが無効化される
- 無効化された職員の全セッションが終了する
- 無効化履歴が記録される
- データは論理削除として保持される

---

## 基本フロー

1. 管理者が職員アカウント管理画面を開く
2. 管理者が無効化対象の職員を選択する
3. 管理者が「無効化」ボタンをクリックする
4. システムが確認ダイアログを表示する
5. 管理者が無効化理由を入力する
6. 管理者が「無効化を実行」ボタンをクリックする
7. システムが職員アカウントを無効化する
8. システムが対象職員の全セッションを無効化する
9. システムが職員一覧画面にリダイレクトする
10. システムが「職員アカウントを無効化しました」と表示する

---

## 代替フロー

### 4a. 管理者が無効化をキャンセルする場合

1. 管理者が「キャンセル」ボタンをクリックする
2. システムが確認ダイアログを閉じる
3. ユースケース終了

### 2a. 自分自身を無効化しようとした場合

1. システムが「自分自身のアカウントは無効化できません」とエラーを表示する
2. ユースケース終了

### 2b. 最後の管理者を無効化しようとした場合

1. システムが「最後の管理者アカウントは無効化できません」とエラーを表示する
2. ユースケース終了

### 7a. 無効化済みアカウントを再有効化する場合

1. 管理者が無効化済み職員を選択する
2. 管理者が「再有効化」ボタンをクリックする
3. システムが確認ダイアログを表示する
4. 管理者が「再有効化を実行」ボタンをクリックする
5. システムが職員アカウントを有効化する
6. システムが「職員アカウントを再有効化しました」と表示する

---

## ビジネスルール

| ルールID | ルール内容 |
|----------|-----------|
| BR-UC001-05-01 | 管理者は自分自身のアカウントを無効化できない |
| BR-UC001-05-02 | システムに最低1人の管理者が存在する必要がある |
| BR-UC001-05-03 | 無効化時は対象職員の全セッションを即時終了する |
| BR-UC001-05-04 | 無効化されたアカウントのデータは論理削除として保持 |
| BR-UC001-05-05 | 無効化操作は監査ログに記録される（理由含む） |
| BR-UC001-05-06 | 無効化されたアカウントは再有効化が可能 |

---

## 非機能要件

| 項目 | 要件 |
|------|------|
| パフォーマンス | 無効化処理は3秒以内に完了する |
| セキュリティ | 無効化時に全セッションを即時無効化 |
| 監査 | 無効化操作と理由をログに記録する |
| データ保持 | 論理削除によりデータを保持（物理削除しない） |

---

## 画面イメージ（概要）

### 職員一覧
- 職員名
- メールアドレス
- 権限
- ステータス（有効/無効）
- 操作ボタン（編集/無効化/再有効化）

### 確認ダイアログ
- 対象職員情報表示
- 無効化理由入力欄（必須）
- 「無効化を実行」ボタン
- 「キャンセル」ボタン

---

## 入力項目

| 項目 | 必須 | 形式 | 備考 |
|------|:----:|------|------|
| 無効化理由 | ○ | 文字列（200文字以内） | 監査ログに記録 |

---

## 関連ユースケース

| ユースケース | 関係 |
|-------------|------|
| UC-001-002_職員ダッシュボード表示 | 管理メニューから遷移 |
| UC-001-003_職員アカウント作成 | 作成後の無効化 |
| UC-001-004_職員アカウント編集 | 編集画面から無効化 |
| UC-001-001_職員ログイン | 無効化されたアカウントはログイン不可 |

---

## 技術実装メモ

- API エンドポイント: DELETE /api/staff/accounts/{id}（論理削除）
- 再有効化: POST /api/staff/accounts/{id}/reactivate
- セッション無効化: sessions テーブルから対象ユーザーのレコードを削除
- 論理削除: is_active カラムを false に設定
- 監査ログ: security チャンネルに記録（無効化理由含む）

---

## 関連ドキュメント

- [セキュリティ標準 - セッション管理](../../../../00_docs/20_tech/99_standard/security/02_SessionManagement.md)
- [セキュリティ標準 - 監査ログ](../../../../00_docs/20_tech/99_standard/security/05_AuditLogging.md)
