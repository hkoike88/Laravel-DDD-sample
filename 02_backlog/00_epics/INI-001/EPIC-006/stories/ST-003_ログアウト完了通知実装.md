# ST-003: ログアウト完了通知の実装

最終更新: 2025-12-24

---

## ストーリー

**職員として**、ログアウト完了後にメッセージを確認したい。
**なぜなら**、ログアウトが正常に完了したことを確認したいからだ。

---

## 関連情報

| 項目 | 値 |
|------|-----|
| Epic | [EPIC-006: 職員ログアウト機能](../epic.md) |
| ポイント | 1 |
| 優先度 | Should |
| ステータス | Planned |

---

## 受け入れ条件

1. [ ] ログアウト完了後、ログイン画面に「ログアウトしました」と表示されること
2. [ ] メッセージは一定時間後に自動で消えること（または手動で閉じられること）
3. [ ] メッセージはページリロード後には表示されないこと

---

## 技術仕様

### メッセージ表示方式

React Router の `state` を使用して、ログアウト完了メッセージをログイン画面に渡す。

### コンポーネント構成

```
frontend/src/
├── components/
│   └── common/
│       └── Toast.tsx           # トースト通知コンポーネント
├── pages/
│   └── Auth/
│       └── LoginPage.tsx       # ログイン画面（更新）
```

### Toast コンポーネント実装

```tsx
interface ToastProps {
  message: string;
  type?: 'success' | 'error' | 'info';
  duration?: number;
  onClose?: () => void;
}

export const Toast: FC<ToastProps> = ({
  message,
  type = 'success',
  duration = 5000,
  onClose,
}) => {
  const [isVisible, setIsVisible] = useState(true);

  useEffect(() => {
    const timer = setTimeout(() => {
      setIsVisible(false);
      onClose?.();
    }, duration);

    return () => clearTimeout(timer);
  }, [duration, onClose]);

  if (!isVisible) return null;

  const bgColor = {
    success: 'bg-green-100 border-green-500 text-green-700',
    error: 'bg-red-100 border-red-500 text-red-700',
    info: 'bg-blue-100 border-blue-500 text-blue-700',
  }[type];

  return (
    <div
      className={`fixed top-4 right-4 px-4 py-3 rounded border-l-4 ${bgColor}`}
      role="alert"
    >
      <div className="flex items-center justify-between">
        <p>{message}</p>
        <button
          onClick={() => {
            setIsVisible(false);
            onClose?.();
          }}
          className="ml-4 text-lg font-bold"
        >
          &times;
        </button>
      </div>
    </div>
  );
};
```

### LoginPage 更新

```tsx
export const LoginPage: FC = () => {
  const location = useLocation();
  const navigate = useNavigate();
  const [toastMessage, setToastMessage] = useState<string | null>(null);

  useEffect(() => {
    // ログアウト完了メッセージをチェック
    const state = location.state as { message?: string } | null;
    if (state?.message) {
      setToastMessage(state.message);
      // state をクリア（リロード時に再表示されないように）
      navigate(location.pathname, { replace: true, state: {} });
    }
  }, [location, navigate]);

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-100">
      {toastMessage && (
        <Toast
          message={toastMessage}
          type="success"
          onClose={() => setToastMessage(null)}
        />
      )}

      <div className="max-w-md w-full bg-white rounded-lg shadow-md p-8">
        <h1 className="text-2xl font-bold text-center mb-6">
          職員ログイン
        </h1>
        <LoginForm />
      </div>
    </div>
  );
};
```

### ログアウト時の遷移（useLogout 更新）

```tsx
// useLogout.ts
navigate('/login', {
  replace: true,
  state: { message: 'ログアウトしました' }
});
```

---

## 成果物

| 成果物 | 配置場所 |
|--------|---------|
| Toast | frontend/src/components/common/Toast.tsx |
| LoginPage（更新） | frontend/src/pages/Auth/LoginPage.tsx |

---

## タスク

### Design Tasks（外部設計）

- [ ] トースト通知のデザイン確定
- [ ] 表示時間の確定（デフォルト5秒）

### Spec Tasks（詳細設計）

- [ ] Toast コンポーネント実装
- [ ] LoginPage にメッセージ表示機能追加
- [ ] コンポーネントテスト作成

---

## 変更履歴

| 日付 | 変更内容 |
|------|---------|
| 2025-12-24 | 初版作成 |
