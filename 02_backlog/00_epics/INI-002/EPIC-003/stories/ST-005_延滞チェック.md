# ST-005: 延滞チェックの実装

最終更新: 2025-12-24

---

## ストーリー

**図書館職員として**、延滞中の利用者への新規貸出を防ぎたい。
**なぜなら**、延滞解消を促進し、図書の適正な回転を維持したいからだ。

---

## 関連情報

| 項目 | 値 |
|------|-----|
| Epic | [EPIC-003: 貸出処理](../epic.md) |
| ポイント | 2 |
| 優先度 | Must |
| ステータス | Draft |

---

## 受け入れ条件

1. [ ] 延滞中の図書がある利用者への貸出がブロックされること
2. [ ] 延滞中の図書情報が表示されること
3. [ ] 延滞日数が表示されること

---

## タスク

### Design Tasks（外部設計）

- [ ] 延滞判定ルールの確認

### Spec Tasks（詳細設計）

- [ ] OverdueChecker ドメインサービスの実装
- [ ] 延滞図書取得クエリの実装
- [ ] UseCase への統合
- [ ] 単体テストの作成

---

## ビジネスルール

| ルール | 内容 |
|--------|------|
| 延滞判定 | due_at < 現在日時 かつ returned_at IS NULL |
| 新規貸出 | 1件でも延滞があればブロック |
| 延滞日数 | 現在日時 - due_at（切り上げ） |

---

## 変更履歴

| 日付 | 変更内容 |
|------|---------|
| 2025-12-24 | 初版作成 |
