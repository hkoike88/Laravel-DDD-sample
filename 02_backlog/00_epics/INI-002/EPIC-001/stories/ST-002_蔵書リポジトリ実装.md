# ST-002: 蔵書リポジトリの実装

最終更新: 2025-12-24

---

## ストーリー

**開発者として**、蔵書のリポジトリを実装したい。
**なぜなら**、ドメイン層とインフラ層を分離し、データベースアクセスを抽象化したいからだ。

---

## 関連情報

| 項目 | 値 |
|------|-----|
| Epic | [EPIC-001: 蔵書検索](../epic.md) |
| ポイント | 3 |
| 優先度 | Must |
| ステータス | Draft |

---

## 受け入れ条件

1. [ ] BookRepositoryInterface が定義されていること
2. [ ] EloquentBookRepository が実装されていること
3. [ ] マイグレーションファイルが作成されていること
4. [ ] 検索メソッド（findByConditions）が実装されていること
5. [ ] リポジトリテストが作成されていること

---

## 技術仕様

### リポジトリインターフェース

```php
interface BookRepositoryInterface
{
    public function findById(BookId $id): ?Book;
    public function findByConditions(BookSearchCriteria $criteria): BookCollection;
    public function save(Book $book): void;
    public function count(BookSearchCriteria $criteria): int;
}
```

### マイグレーション

```php
Schema::create('books', function (Blueprint $table) {
    $table->uuid('id')->primary();
    $table->string('title');
    $table->string('author')->nullable();
    $table->string('isbn', 13)->nullable();
    $table->string('publisher')->nullable();
    $table->integer('published_year')->nullable();
    $table->string('genre', 100)->nullable();
    $table->enum('status', ['available', 'borrowed', 'reserved'])->default('available');
    $table->timestamps();

    $table->index('title');
    $table->index('author');
    $table->index('isbn');
});
```

---

## 成果物

| 成果物 | 配置場所 |
|--------|---------|
| BookRepositoryInterface.php | backend/packages/Domain/Book/ |
| EloquentBookRepository.php | backend/packages/Infrastructure/Persistence/ |
| BookEloquentModel.php | backend/packages/Infrastructure/Persistence/ |
| 2024_xx_xx_create_books_table.php | backend/database/migrations/ |
| BookRepositoryTest.php | backend/tests/Integration/ |

---

## タスク

### Design Tasks（外部設計）

- [ ] リポジトリインターフェース設計
- [ ] テーブル設計（カラム、インデックス）

### Spec Tasks（詳細設計）

- [ ] マイグレーションファイル作成
- [ ] Eloquent モデル作成
- [ ] リポジトリ実装
- [ ] 統合テスト作成

---

## 変更履歴

| 日付 | 変更内容 |
|------|---------|
| 2025-12-24 | 初版作成 |
