# ST-004: 予約連携（取り置き処理）の実装

最終更新: 2025-12-24

---

## ストーリー

**図書館職員として**、返却時に予約がある場合、取り置き処理を行いたい。
**なぜなら**、予約者に確実に図書を渡したいからだ。

---

## 関連情報

| 項目 | 値 |
|------|-----|
| Epic | [EPIC-004: 返却処理](../epic.md) |
| ポイント | 3 |
| 優先度 | Should |
| ステータス | Draft |

---

## 受け入れ条件

1. [ ] 返却時に予約があれば自動で取り置き状態になること
2. [ ] 取り置き期限（7日）が自動設定されること
3. [ ] 予約者への連絡が促されること
4. [ ] 取り置き中の図書が貸出可能な図書から除外されること

---

## タスク

### Design Tasks（外部設計）

- [ ] 取り置きワークフローの設計

### Spec Tasks（詳細設計）

- [ ] HoldForReservationService の実装
- [ ] 予約状態の更新ロジック実装
- [ ] 取り置き期限の自動計算
- [ ] 返却 API への統合
- [ ] 単体テストの作成

---

## ビジネスルール

| ルール | 内容 |
|--------|------|
| 取り置き期限 | 返却日 + 7日 |
| 期限切れ時 | 次の予約者へ繰り上げ、または貸出可能に |
| 通知 | 連絡待ちリストに追加 |

---

## 状態遷移

```
[貸出中] → [返却]
              ↓
    予約あり? ─ Yes → [取り置き中] → 期限切れ → [次の予約者へ or 貸出可能]
         │
         No → [貸出可能]
```

---

## 変更履歴

| 日付 | 変更内容 |
|------|---------|
| 2025-12-24 | 初版作成 |
