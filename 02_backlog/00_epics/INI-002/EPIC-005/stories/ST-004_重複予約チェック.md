# ST-004: 重複予約チェックの実装

最終更新: 2025-12-24

---

## ストーリー

**図書館職員として**、同一利用者による同一図書への重複予約を防ぎたい。
**なぜなら**、公平な予約管理を行いたいからだ。

---

## 関連情報

| 項目 | 値 |
|------|-----|
| Epic | [EPIC-005: 予約登録](../epic.md) |
| ポイント | 2 |
| 優先度 | Must |
| ステータス | Draft |

---

## 受け入れ条件

1. [ ] 同一利用者による同一図書への予約がブロックされること
2. [ ] 警告メッセージが表示されること
3. [ ] 既存の予約情報（順番）が表示されること

---

## タスク

### Design Tasks（外部設計）

- [ ] 重複判定ルールの確認

### Spec Tasks（詳細設計）

- [ ] DuplicateReservationChecker ドメインサービスの実装
- [ ] 既存予約確認クエリの実装
- [ ] UseCase への統合
- [ ] 単体テストの作成

---

## ビジネスルール

| ルール | 内容 |
|--------|------|
| 重複判定 | 同一 patron_id と book_id の組み合わせ |
| 対象ステータス | waiting, ready の予約のみ（completed, cancelled, expired は除外） |
| 既存予約表示 | 予約日と順番を表示 |

---

## 変更履歴

| 日付 | 変更内容 |
|------|---------|
| 2025-12-24 | 初版作成 |
