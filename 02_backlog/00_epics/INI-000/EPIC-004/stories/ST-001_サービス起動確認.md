# ST-001: 全サービスの起動確認

最終更新: 2025-12-23

---

## ストーリー

**開発者として**、全てのDockerサービスが正常に起動することを確認したい。
**なぜなら**、開発環境が正しく構築されていることを保証したいからだ。

---

## 関連情報

| 項目 | 値 |
|------|-----|
| Epic | [EPIC-004: 開発環境動作確認](../epic.md) |
| ポイント | 1 |
| 優先度 | Must |
| ステータス | Draft |

---

## 受け入れ条件

1. [ ] `docker compose up -d` で全コンテナが起動すること
2. [ ] `docker compose ps` で全サービスが Running 状態であること
3. [ ] フロントエンド（http://localhost:5173）にアクセスできること
4. [ ] バックエンド（http://localhost:8000）にアクセスできること
5. [ ] phpMyAdmin（http://localhost:8080）にアクセスできること
6. [ ] Nginx（http://localhost:80）経由でアクセスできること

---

## 確認手順

### 1. サービス起動

```bash
# 全サービスをバックグラウンドで起動
docker compose up -d

# ビルドを含めて起動（初回または Dockerfile 変更時）
docker compose up -d --build
```

### 2. ステータス確認

```bash
# コンテナ状態確認
docker compose ps

# 期待される出力
NAME                STATUS          PORTS
sample-001-backend-1    running    0.0.0.0:8000->8000/tcp
sample-001-db-1         running    0.0.0.0:3306->3306/tcp
sample-001-frontend-1   running    0.0.0.0:5173->5173/tcp
sample-001-nginx-1      running    0.0.0.0:80->80/tcp
sample-001-phpmyadmin-1 running    0.0.0.0:8080->80/tcp
```

### 3. アクセス確認

```bash
# フロントエンド
curl -I http://localhost:5173
# 期待: HTTP/1.1 200 OK

# バックエンド
curl -I http://localhost:8000
# 期待: HTTP/1.1 200 OK

# バックエンド API
curl http://localhost:8000/api/health
# 期待: {"status":"ok",...}

# phpMyAdmin
curl -I http://localhost:8080
# 期待: HTTP/1.1 200 OK

# Nginx 経由
curl -I http://localhost:80
# 期待: HTTP/1.1 200 OK
```

### 4. ログ確認

```bash
# 全サービスのログ
docker compose logs

# 特定サービスのログ
docker compose logs backend
docker compose logs frontend

# リアルタイムでログを追跡
docker compose logs -f
```

---

## 確認チェックリスト

| サービス | URL | 状態 | 確認 |
|----------|-----|------|------|
| frontend | http://localhost:5173 | Running | [ ] |
| backend | http://localhost:8000 | Running | [ ] |
| db | localhost:3306 | Running | [ ] |
| phpmyadmin | http://localhost:8080 | Running | [ ] |
| nginx | http://localhost:80 | Running | [ ] |

---

## トラブルシューティング

| 問題 | 原因 | 解決策 |
|------|------|--------|
| コンテナが Exited | ビルドエラー | `docker compose logs <service>` でログ確認 |
| ポート使用中 | 他プロセスが使用 | `lsof -i :PORT` で特定し停止 |
| イメージビルド失敗 | Dockerfile エラー | `docker compose build --no-cache` で再ビルド |

---

## タスク

### Spec Tasks（詳細設計）

- [ ] docker compose up -d の実行
- [ ] docker compose ps でステータス確認
- [ ] 各 URL へのアクセス確認
- [ ] エラー発生時のトラブルシューティング

---

## 変更履歴

| 日付 | 変更内容 |
|------|---------|
| 2025-12-23 | 初版作成 |
