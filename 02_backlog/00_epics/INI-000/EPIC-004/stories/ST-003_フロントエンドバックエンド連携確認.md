# ST-003: フロントエンド→バックエンド連携確認

最終更新: 2025-12-23

---

## ストーリー

**開発者として**、フロントエンドからバックエンド API を呼び出せることを確認したい。
**なぜなら**、SPA + REST API 構成が正常に動作することを保証したいからだ。

---

## 関連情報

| 項目 | 値 |
|------|-----|
| Epic | [EPIC-004: 開発環境動作確認](../epic.md) |
| ポイント | 2 |
| 優先度 | Must |
| ステータス | Draft |

---

## 受け入れ条件

1. [ ] フロントエンドから `/api/health` を呼び出せること
2. [ ] レスポンスデータが画面に表示されること
3. [ ] ネットワークタブでリクエスト/レスポンスが確認できること
4. [ ] エラーハンドリングが動作すること
5. [ ] HMR（Hot Module Replacement）が動作すること

---

## 確認手順

### 1. サンプル API 呼び出しコンポーネントの作成

```tsx
// src/features/health/components/HealthCheck.tsx
import { useState, useEffect } from 'react';
import axios from 'axios';

interface HealthResponse {
  status: string;
  database: string;
  timestamp: string;
}

export const HealthCheck = () => {
  const [health, setHealth] = useState<HealthResponse | null>(null);
  const [error, setError] = useState<string | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const checkHealth = async () => {
      try {
        const response = await axios.get<HealthResponse>(
          'http://localhost:8000/api/health'
        );
        setHealth(response.data);
      } catch (err) {
        setError('API 接続に失敗しました');
        console.error(err);
      } finally {
        setLoading(false);
      }
    };

    checkHealth();
  }, []);

  if (loading) return <div>Loading...</div>;
  if (error) return <div className="text-red-500">{error}</div>;

  return (
    <div className="p-4 border rounded">
      <h2 className="text-xl font-bold mb-2">API ヘルスチェック</h2>
      <ul>
        <li>ステータス: {health?.status}</li>
        <li>データベース: {health?.database}</li>
        <li>タイムスタンプ: {health?.timestamp}</li>
      </ul>
    </div>
  );
};
```

### 2. App.tsx に組み込み

```tsx
// src/app/App.tsx
import { HealthCheck } from '../features/health/components/HealthCheck';

function App() {
  return (
    <div className="container mx-auto p-4">
      <h1 className="text-2xl font-bold mb-4">
        図書館デジタル化システム
      </h1>
      <HealthCheck />
    </div>
  );
}

export default App;
```

### 3. 動作確認

1. http://localhost:5173 にアクセス
2. 「API ヘルスチェック」セクションが表示されることを確認
3. ステータス: ok、データベース: connected が表示されることを確認

### 4. 開発者ツールで確認

1. ブラウザの開発者ツールを開く（F12）
2. Network タブを選択
3. `health` リクエストを確認
4. Status: 200、レスポンスボディを確認

### 5. HMR 動作確認

1. HealthCheck.tsx のテキストを変更
2. ブラウザが自動でリロードせずに変更が反映されることを確認

---

## 確認チェックリスト

| 確認項目 | 方法 | 確認 |
|----------|------|------|
| API 呼び出し | HealthCheck コンポーネント | [ ] |
| データ表示 | 画面でレスポンス確認 | [ ] |
| Network 確認 | 開発者ツール | [ ] |
| HMR | ファイル変更時の反映 | [ ] |

---

## トラブルシューティング

| 問題 | 原因 | 解決策 |
|------|------|--------|
| Network Error | バックエンド未起動 | `docker compose up -d backend` |
| CORS エラー | CORS 設定不足 | ST-004 で対応 |
| 404 Not Found | ルート未定義 | routes/api.php を確認 |
| HMR 動作しない | Vite 設定 | vite.config.ts の server.watch 確認 |

---

## タスク

### Spec Tasks（詳細設計）

- [ ] HealthCheck コンポーネントの作成
- [ ] App.tsx への組み込み
- [ ] ブラウザでの動作確認
- [ ] 開発者ツールでのリクエスト確認
- [ ] HMR 動作確認

---

## 変更履歴

| 日付 | 変更内容 |
|------|---------|
| 2025-12-23 | 初版作成 |
