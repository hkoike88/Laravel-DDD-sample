# エッジケーステストケース: 蔵書登録API

## 概要

POST `/api/books` エンドポイントのエッジケース（境界値・特殊条件）テストケース一覧。
境界値テストと複本対応などの特殊なビジネスルールを検証する。

---

## 境界値テスト

### TC-B001: タイトル最大文字数（500文字）

**目的**: タイトルが最大文字数（500文字）ちょうどで登録できること

**前提条件**: なし

**テストデータ**:
```json
{
  "title": "<500文字の文字列>"
}
```

**期待結果**:
- ステータスコード: 201 Created
- タイトルがそのまま保存される

**備考**: 500文字はOK、501文字はNG

---

### TC-B002: 著者名最大文字数（200文字）

**目的**: 著者名が最大文字数（200文字）ちょうどで登録できること

**前提条件**: なし

**テストデータ**:
```json
{
  "title": "テスト書籍",
  "author": "<200文字の文字列>"
}
```

**期待結果**:
- ステータスコード: 201 Created
- 著者名がそのまま保存される

**実装**: `CreateBookTest::test_can_create_book_with_max_length_author`

---

### TC-B003: 出版社名最大文字数（200文字）

**目的**: 出版社名が最大文字数（200文字）ちょうどで登録できること

**前提条件**: なし

**テストデータ**:
```json
{
  "title": "テスト書籍",
  "publisher": "<200文字の文字列>"
}
```

**期待結果**:
- ステータスコード: 201 Created
- 出版社名がそのまま保存される

**実装**: `CreateBookTest::test_can_create_book_with_max_length_publisher`

---

### TC-B004: ジャンル最大文字数（100文字）

**目的**: ジャンルが最大文字数（100文字）ちょうどで登録できること

**前提条件**: なし

**テストデータ**:
```json
{
  "title": "テスト書籍",
  "genre": "<100文字の文字列>"
}
```

**期待結果**:
- ステータスコード: 201 Created
- ジャンルがそのまま保存される

**実装**: `CreateBookTest::test_can_create_book_with_max_length_genre`

---

### TC-B005: 出版年の下限値（1年）

**目的**: 出版年が最小値（1年）で登録できること

**前提条件**: なし

**テストデータ**:
```json
{
  "title": "古代の本",
  "published_year": 1
}
```

**期待結果**:
- ステータスコード: 201 Created
- 出版年が1として保存される

**実装**: `CreateBookTest::test_can_create_book_with_boundary_published_year`

---

### TC-B006: 出版年の上限値（現在年+5）

**目的**: 出版年が最大値（現在年+5年）で登録できること

**前提条件**: なし

**テストデータ**:
```json
{
  "title": "予定出版の本",
  "published_year": 2030
}
```
※ 現在年が2025年の場合

**期待結果**:
- ステータスコード: 201 Created
- 出版年が2030として保存される

**実装**: `CreateBookTest::test_can_create_book_with_boundary_published_year`

---

## ISBN形式テスト

### TC-I001: ISBN-10形式（10桁数字）

**目的**: ISBN-10形式で登録できること

**前提条件**: なし

**テストデータ**:
```json
{
  "title": "吾輩は猫である",
  "isbn": "4003101014"
}
```

**期待結果**:
- ステータスコード: 201 Created
- ISBNが `4003101014` として保存される

**実装**: `CreateBookHandlerTest::test_can_create_book_with_isbn10`

---

### TC-I002: ISBN-10形式（チェックディジットX）

**目的**: チェックディジットがXのISBN-10で登録できること

**前提条件**: なし

**テストデータ**:
```json
{
  "title": "テスト書籍",
  "isbn": "155860832X"
}
```

**期待結果**:
- ステータスコード: 201 Created
- ISBNが `155860832X` として保存される

---

### TC-I003: ISBN-13形式（ハイフンなし）

**目的**: ハイフンなしISBN-13で登録できること

**前提条件**: なし

**テストデータ**:
```json
{
  "title": "吾輩は猫である",
  "isbn": "9784003101018"
}
```

**期待結果**:
- ステータスコード: 201 Created
- ISBNがそのまま保存される

---

### TC-I004: ISBN-13形式（ハイフン付き）

**目的**: ハイフン付きISBN-13が正規化されること

**前提条件**: なし

**テストデータ**:
```json
{
  "title": "吾輩は猫である",
  "isbn": "978-4-00-310101-8"
}
```

**期待結果**:
- ステータスコード: 201 Created
- ISBNが `9784003101018` に正規化されて保存される

**実装**: `CreateBookHandlerTest::test_can_create_book_with_hyphenated_isbn13`

---

### TC-I005: ISBN-13形式（ISBNプレフィックス付き）

**目的**: "ISBN"プレフィックス付きでも登録できること

**前提条件**: なし

**テストデータ**:
```json
{
  "title": "吾輩は猫である",
  "isbn": "ISBN978-4-00-310101-8"
}
```

**期待結果**:
- ステータスコード: 201 Created
- ISBNが `9784003101018` に正規化されて保存される

---

## 複本対応テスト

### TC-D001: 同一ISBNで複数登録

**目的**: 同じISBNを持つ蔵書を複数登録できること（複本対応）

**前提条件**: ISBN `9784003101018` の蔵書が既に1件登録済み

**テストデータ**:
```json
{
  "title": "吾輩は猫である（2冊目）",
  "isbn": "9784003101018"
}
```

**期待結果**:
- ステータスコード: 201 Created
- 異なるIDで登録される
- データベースに同一ISBNのレコードが2件存在する

**実装**: `CreateBookTest::test_can_create_multiple_books_with_same_isbn`

**備考**:
図書館システムでは同じ本を複数冊所蔵することが一般的。
ISBNのユニーク制約は設けない。

---

### TC-D002: 同一タイトル・著者で複数登録

**目的**: 同じタイトル・著者の蔵書を複数登録できること

**前提条件**: タイトル「吾輩は猫である」著者「夏目漱石」の蔵書が既に登録済み

**テストデータ**:
```json
{
  "title": "吾輩は猫である",
  "author": "夏目漱石"
}
```

**期待結果**:
- ステータスコード: 201 Created
- 異なるIDで登録される

---

## ID生成テスト

### TC-U001: ULID形式のID生成

**目的**: 登録時にULID形式のIDが自動生成されること

**前提条件**: なし

**テストデータ**:
```json
{
  "title": "吾輩は猫である"
}
```

**期待結果**:
- レスポンスのIDが26文字である
- IDがULID形式（大文字英数字、ソート可能）である

**実装**: `CreateBookHandlerTest::test_created_book_has_ulid_id`

**備考**:
- ULID例: `01ARZ3NDEKTSV4RRFFQ69G5FAV`
- 時系列でソート可能な特性を持つ

---

## 特殊文字テスト

### TC-S001: 日本語タイトル

**目的**: 日本語（ひらがな、カタカナ、漢字）のタイトルで登録できること

**テストデータ**:
```json
{
  "title": "吾輩は猫である"
}
```

**期待結果**: 201 Created

---

### TC-S002: 英語タイトル

**目的**: 英語のタイトルで登録できること

**テストデータ**:
```json
{
  "title": "The Great Gatsby"
}
```

**期待結果**: 201 Created

---

### TC-S003: 記号を含むタイトル

**目的**: 記号を含むタイトルで登録できること

**テストデータ**:
```json
{
  "title": "C++プログラミング入門 〜基礎から応用まで〜"
}
```

**期待結果**: 201 Created

---

### TC-S004: 絵文字を含むタイトル

**目的**: 絵文字を含むタイトルで登録できること

**テストデータ**:
```json
{
  "title": "楽しいプログラミング📚"
}
```

**期待結果**: 201 Created

---

## 境界値サマリー

| フィールド | 最小値 | 最大値 | 境界テスト |
|-----------|-------|-------|-----------|
| title | 1文字 | 500文字 | 1文字OK, 500文字OK, 501文字NG |
| author | - | 200文字 | 200文字OK, 201文字NG |
| publisher | - | 200文字 | 200文字OK, 201文字NG |
| genre | - | 100文字 | 100文字OK, 101文字NG |
| published_year | 1 | 現在年+5 | 1年OK, 0年NG, 現在年+5年OK, 現在年+6年NG |
| isbn | 10桁 | 13桁 | ISBN-10 OK, ISBN-13 OK |

---

## 関連ファイル

- テスト実装: `backend/tests/Feature/Book/CreateBookTest.php`
- テスト実装: `backend/tests/Unit/Domain/Book/UseCases/CreateBookHandlerTest.php`
- バリデーション: `backend/packages/Domain/Book/Presentation/HTTP/Requests/CreateBookRequest.php`
- 対象API: `POST /api/books`
