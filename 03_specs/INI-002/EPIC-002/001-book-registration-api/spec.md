# Feature Specification: 蔵書登録API実装

**Feature Branch**: `001-book-registration-api`
**Created**: 2025-12-24
**Status**: Draft
**Input**: 図書館職員として、新規購入した図書をシステムに登録したい。登録した図書を検索可能にし、貸出管理を行いたい。

## Clarifications

### Session 2025-12-24

- Q: 出版社・ジャンルの最大長制限は？ → A: 出版社: 200文字、ジャンル: 100文字

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 図書情報の登録 (Priority: P1)

図書館職員は、新規購入した図書の情報をシステムに登録する。タイトルを必須項目として入力し、著者名、ISBN、出版社、出版年、ジャンルなどのオプション情報も登録できる。

**Why this priority**: 蔵書登録はこの機能の中核であり、これがなければ他の機能（検索、貸出管理）が成り立たない。最も基本的かつ重要な機能。

**Independent Test**: 図書情報を入力して登録ボタンを押すと、システムに登録され、登録完了の確認ができる。

**Acceptance Scenarios**:

1. **Given** 職員が蔵書登録画面を開いている, **When** タイトル「吾輩は猫である」を入力して登録を実行, **Then** 蔵書が正常に登録され、登録完了メッセージが表示される
2. **Given** 職員が蔵書登録画面を開いている, **When** タイトル「吾輩は猫である」、著者「夏目漱石」、出版社「岩波書店」、出版年「1905」を入力して登録を実行, **Then** すべての情報が正しく登録される
3. **Given** 職員が蔵書登録画面を開いている, **When** タイトル「吾輩は猫である」、ISBN「978-4-00-310101-8」を入力して登録を実行, **Then** ISBN付きで蔵書が登録される

---

### User Story 2 - 登録時の入力検証 (Priority: P1)

図書館職員が登録時に入力した情報が適切な形式であるかシステムが検証し、問題がある場合は明確なエラーメッセージを表示する。

**Why this priority**: データ品質を維持するために入力検証は必須。不正なデータがシステムに入ることを防ぐ。

**Independent Test**: 無効な情報を入力した際に、適切なエラーメッセージが表示される。

**Acceptance Scenarios**:

1. **Given** 職員が蔵書登録画面を開いている, **When** タイトルを空のまま登録を実行, **Then** 「タイトルは必須です」というエラーメッセージが表示される
2. **Given** 職員が蔵書登録画面を開いている, **When** 不正なISBN形式「123456」を入力して登録を実行, **Then** 「ISBNの形式が正しくありません」というエラーメッセージが表示される
3. **Given** 職員が蔵書登録画面を開いている, **When** 出版年に「abc」という非数値を入力して登録を実行, **Then** 「出版年は数値で入力してください」というエラーメッセージが表示される

---

### User Story 3 - 登録結果の確認 (Priority: P2)

図書館職員は、登録が完了した図書の詳細情報を確認できる。

**Why this priority**: 登録内容の確認は重要だが、登録自体が完了していれば基本的な価値は提供される。

**Independent Test**: 登録完了後に表示される確認画面で、登録した情報が正しく表示される。

**Acceptance Scenarios**:

1. **Given** 職員が図書を登録した直後, **When** 登録完了画面が表示される, **Then** 登録した図書のタイトル、著者、ISBN等の情報が確認できる
2. **Given** 職員が図書を登録した直後, **When** 登録完了画面から検索画面に遷移して該当図書を検索, **Then** 登録した図書が検索結果に表示される

---

### Edge Cases

- タイトルが空白文字のみの場合はどうなるか？ → 空文字と同様にエラー
- ISBNが未入力の場合でも登録できるか？ → 登録可能（ISBNはオプション）
- 非常に長いタイトル（1000文字以上）を入力した場合は？ → 適切な上限でエラー表示
- 出版年が未来の年（例：2030年）の場合は？ → 登録可能（予約出版対応）
- 出版年が現実的でない年（例：0年、-100年）の場合は？ → 妥当な範囲チェックでエラー

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは蔵書登録機能を提供し、タイトルを必須入力として受け付けなければならない
- **FR-002**: システムはタイトルが空または空白文字のみの場合、エラーを返さなければならない
- **FR-003**: システムは著者名、出版社、出版年、ジャンルをオプション項目として受け付けなければならない
- **FR-004**: システムはISBN-10またはISBN-13形式のISBNを受け付け、形式が不正な場合はエラーを返さなければならない
- **FR-005**: システムは登録成功時に、登録された蔵書情報と一意な識別子を返さなければならない
- **FR-006**: システムは入力値が不正な場合、どの項目がどのように不正かを明確に示すエラーメッセージを返さなければならない
- **FR-007**: システムは登録された蔵書を「利用可能」状態で初期化しなければならない
- **FR-008**: システムはタイトルの最大長を500文字に制限しなければならない
- **FR-009**: システムは著者名の最大長を200文字に制限しなければならない
- **FR-010**: システムは出版年を1年から現在年+5年の範囲で受け付けなければならない
- **FR-011**: システムは出版社名の最大長を200文字に制限しなければならない
- **FR-012**: システムはジャンルの最大長を100文字に制限しなければならない

### Key Entities

- **Book（蔵書）**: 図書館が所蔵する書籍。タイトル（必須）、著者名、ISBN、出版社、出版年、ジャンル、貸出状態を持つ
- **BookId（蔵書ID）**: 蔵書を一意に識別するID。システムが自動生成
- **ISBN**: 国際標準図書番号。ISBN-10またはISBN-13形式
- **BookStatus（貸出状態）**: 蔵書の状態（利用可能、貸出中、予約中など）

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 職員は1分以内に図書1冊の登録を完了できる
- **SC-002**: 入力エラー時、職員は3秒以内にエラー内容を把握できる
- **SC-003**: 登録された図書は即座に検索機能で発見可能になる
- **SC-004**: システムは1日あたり100冊以上の図書登録を処理できる
- **SC-005**: 入力検証により、データベースに保存される蔵書情報の100%が規定フォーマットに準拠する

## Assumptions

- 図書館職員は認証済みの状態でシステムを使用している（認証機能は別機能として提供）
- ISBN形式は国際標準（ISBN-10、ISBN-13）に準拠する
- 複本（同一ISBNの複数冊）は別々の蔵書IDで登録可能。ISBN重複時の警告表示機能はST-003のスコープであり、本機能（ST-001）では実装しない
- 日本語および英語のタイトル・著者名を扱う
- 登録時のファイルアップロード（書影画像など）は本機能のスコープ外
