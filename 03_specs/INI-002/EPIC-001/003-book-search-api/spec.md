# Feature Specification: 蔵書検索API

**Feature Branch**: `003-book-search-api`
**Created**: 2025-12-24
**Status**: Draft
**Input**: User description: "蔵書検索API実装 - フロントエンド開発者が蔵書を検索するAPIを呼び出し、検索条件を送信して蔵書一覧を取得し画面に表示できるようにする"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - キーワード検索による蔵書一覧取得 (Priority: P1)

フロントエンド開発者が、タイトルまたは著者名で蔵書を検索し、条件に一致する蔵書の一覧を取得する。ユーザーは検索フォームに文字列を入力し、検索ボタンを押すと、システムが条件に一致する蔵書を一覧で返す。

**Why this priority**: 蔵書検索機能の最も基本的かつ頻繁に使用される機能であり、これがないと蔵書を探すことができない。

**Independent Test**: タイトルまたは著者名で検索リクエストを送信し、該当する蔵書が一覧で返却されることを確認できる。

**Acceptance Scenarios**:

1. **Given** 蔵書「吾輩は猫である」（著者: 夏目漱石）が登録されている, **When** タイトル「猫」で検索する, **Then** 「吾輩は猫である」が検索結果に含まれる
2. **Given** 蔵書が複数登録されている, **When** 著者名「夏目」で検索する, **Then** 著者名に「夏目」を含む蔵書のみが検索結果に返される
3. **Given** タイトルと著者名の両方で検索する, **When** タイトル「猫」かつ著者「夏目」で検索する, **Then** 両方の条件を満たす蔵書のみが返される

---

### User Story 2 - ISBN による蔵書検索 (Priority: P1)

フロントエンド開発者が、ISBN番号を指定して特定の蔵書を検索する。バーコードスキャンなどで取得したISBNを使用して、特定の書籍を正確に検索する。

**Why this priority**: ISBNによる完全一致検索は、蔵書を一意に特定する最も確実な方法であり、運用上重要。

**Independent Test**: 存在するISBNで検索リクエストを送信し、該当する蔵書が1件返却されることを確認できる。

**Acceptance Scenarios**:

1. **Given** ISBN「9784003101018」の蔵書が登録されている, **When** ISBN「9784003101018」で検索する, **Then** 該当する蔵書が1件返される
2. **Given** ISBN「9999999999999」の蔵書が登録されていない, **When** 存在しないISBNで検索する, **Then** 空の結果が返される

---

### User Story 3 - 検索結果のページネーション (Priority: P2)

フロントエンド開発者が、大量の検索結果をページ単位で取得する。検索結果が多い場合でも、適切なページサイズで分割して取得できるため、画面の表示速度とユーザー体験を損なわない。

**Why this priority**: 検索結果が大量にある場合のパフォーマンスとユーザビリティに直結するが、基本的な検索機能が動作した後に実装可能。

**Independent Test**: ページ番号とページサイズを指定して、指定されたページの結果のみが返却されることを確認できる。

**Acceptance Scenarios**:

1. **Given** 100件の蔵書が登録されている, **When** ページサイズ20で検索する, **Then** 最大20件の蔵書と総件数・総ページ数の情報が返される
2. **Given** 100件の蔵書が登録されている, **When** ページ3、ページサイズ20で検索する, **Then** 41件目から60件目の蔵書が返される
3. **Given** 15件の蔵書が登録されている, **When** ページサイズ20で検索する, **Then** 15件の蔵書と「全1ページ」の情報が返される

---

### User Story 4 - 検索条件なしでの蔵書一覧取得 (Priority: P2)

フロントエンド開発者が、検索条件を指定せずに全蔵書の一覧を取得する。蔵書管理画面の初期表示や、フィルタをリセットした際に使用する。

**Why this priority**: 蔵書一覧の初期表示に必要だが、検索機能の派生機能として実装可能。

**Independent Test**: 検索条件なしでリクエストを送信し、全蔵書がページネーションされて返却されることを確認できる。

**Acceptance Scenarios**:

1. **Given** 50件の蔵書が登録されている, **When** 検索条件なしで検索する, **Then** ページネーションされた蔵書一覧が返される

---

### Edge Cases

- 検索条件に一致する蔵書が0件の場合、空の配列が返される
- ページ番号が総ページ数を超えている場合、空の配列が返される
- ページサイズに不正な値（0以下、上限超過）が指定された場合、適切なエラーまたはデフォルト値が適用される
- 検索文字列に特殊文字やSQLインジェクション文字が含まれる場合、安全に処理される
- 検索文字列が非常に長い場合、適切にバリデーションされる

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは、タイトルによる部分一致検索を提供しなければならない
- **FR-002**: システムは、著者名による部分一致検索を提供しなければならない
- **FR-003**: システムは、ISBNによる完全一致検索を提供しなければならない（ISBN-10およびISBN-13の両形式に対応）
- **FR-004**: システムは、複数の検索条件を組み合わせた検索（AND条件）を提供しなければならない
- **FR-005**: システムは、検索結果をページ単位で分割して返却しなければならない
- **FR-006**: システムは、検索結果の総件数と総ページ数の情報を返却しなければならない
- **FR-007**: システムは、ページサイズのデフォルト値として20件を適用しなければならない
- **FR-008**: システムは、ページサイズの上限を100件に制限しなければならない
- **FR-009**: システムは、検索条件なしのリクエストに対して全蔵書をページネーション付きで返却しなければならない
- **FR-010**: システムは、検索結果が0件の場合、空の配列を返却しなければならない
- **FR-011**: システムは、不正なパラメータに対して適切なエラーメッセージを返却しなければならない
- **FR-012**: システムは、検索入力に対してセキュリティ上安全な処理を行わなければならない

### Key Entities

- **蔵書（Book）**: 図書館で管理される書籍。識別子、タイトル、著者名、ISBN、出版社、出版年、ジャンル、貸出状態を持つ
- **検索条件（SearchCriteria）**: 蔵書検索のためのフィルタ条件。タイトル、著者名、ISBNの各検索条件を含む
- **ページネーション情報（PaginationMeta）**: 検索結果の分割情報。総件数、現在のページ番号、ページサイズ、総ページ数を含む

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 蔵書検索結果が30秒以内に返却される
- **SC-002**: 1000件の蔵書がある状態で、任意の検索条件での応答時間が5秒以内である
- **SC-003**: 検索条件に一致するすべての蔵書が結果に含まれる（検索精度100%）
- **SC-004**: 不正な入力に対して、ユーザーが理解できるエラーメッセージが表示される
- **SC-005**: ページネーションを使用して、任意のページの結果を取得できる
- **SC-006**: 同時10ユーザーからのリクエストに対して、応答時間の劣化なく処理できる

## Clarifications

### Session 2025-12-24

- Q: 検索結果のソート順は変更可能か？ → A: デフォルトのソート順のみ（ソート変更不可）
- Q: 同時リクエスト数の想定は？ → A: 同時10ユーザー程度（小規模図書館想定）
- Q: ISBNの形式は？ → A: 両方サポート（ISBN-10: 10桁、ISBN-13: 13桁）

## Assumptions

- 蔵書データは既に別のストーリーで登録されており、検索対象のデータが存在する
- 認証・認可は本機能の対象外とし、すべてのリクエストは認証済みとして扱う
- 検索は日本語・英語両方のタイトル・著者名に対応する
- 部分一致検索は大文字・小文字を区別しない
- ソート順はデフォルトでタイトル昇順とする

## Scope Exclusions

- 蔵書データの登録・更新・削除機能（別ストーリー）
- 全文検索やあいまい検索（本ストーリーでは部分一致のみ）
- 検索履歴の保存
- 検索結果のキャッシュ
- 認証・認可の実装
- ソート順の変更機能（デフォルトのタイトル昇順のみ）
