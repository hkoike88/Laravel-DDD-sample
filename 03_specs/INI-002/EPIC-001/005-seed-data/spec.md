# Feature Specification: シードデータ投入

**Feature Branch**: `005-seed-data`
**Created**: 2025-12-24
**Status**: Draft
**Input**: User description: "開発者が既存のExcelデータをシードとしてインポートして実データで検索機能を検証"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - コマンドでサンプルデータを投入する (Priority: P1)

開発者として、シードコマンドを実行することで、事前定義されたサンプル蔵書データをデータベースに投入したい。これにより、検索機能やその他の機能を実際のデータで検証できるようになる。

**Why this priority**: 開発・テスト環境でリアルなデータを使った検証は、機能の妥当性確認に不可欠であり、本機能の主目的である。

**Independent Test**: シードコマンドを実行し、データベースに100件以上の蔵書データが投入されていることを確認することで、独立してテスト可能。

**Acceptance Scenarios**:

1. **Given** 空のデータベース、**When** シードコマンドを実行する、**Then** 100件以上の蔵書データがデータベースに投入される
2. **Given** シードコマンド実行後、**When** データベースを確認する、**Then** 各蔵書状態（貸出可・貸出中・予約あり）のデータが含まれている
3. **Given** シードコマンド実行後、**When** データベースを確認する、**Then** 日本語のタイトル・著者名のデータが含まれている
4. **Given** シードコマンド実行後、**When** 蔵書検索機能を使用する、**Then** 投入されたデータが正しく検索できる

---

### User Story 2 - 外部ファイルからデータをインポートする (Priority: P2)

開発者として、CSVファイルから蔵書データをインポートしたい。これにより、既存のExcelデータを変換してシステムに取り込むことができる。

**Why this priority**: 将来的に実際の運用データを取り込む際に必要な機能であるが、まずは事前定義データでの検証が優先される。

**Independent Test**: CSVファイルを用意し、インポートコマンドを実行して、ファイル内のデータがデータベースに正しく投入されることを確認する。

**Acceptance Scenarios**:

1. **Given** 有効な形式のCSVファイル、**When** インポートコマンドを実行する、**Then** ファイル内の全データがデータベースに投入される
2. **Given** 不正な形式のCSVファイル、**When** インポートコマンドを実行する、**Then** エラーメッセージが表示され、不正なデータは投入されない
3. **Given** ISBNが重複するデータを含むCSVファイル、**When** インポートコマンドを実行する、**Then** 重複データはスキップまたは更新され、処理結果が報告される

---

### User Story 3 - ランダムなテストデータを生成する (Priority: P3)

開発者として、ランダムな蔵書データを任意の件数生成したい。これにより、大量データでのパフォーマンステストや、様々なパターンのデータでの動作確認ができる。

**Why this priority**: パフォーマンステストや負荷テストのために有用だが、基本的な検証には事前定義データで十分である。

**Independent Test**: データ生成コマンドに件数を指定して実行し、指定件数のランダムデータが生成されることを確認する。

**Acceptance Scenarios**:

1. **Given** 空のデータベース、**When** 500件のランダムデータ生成を指定してコマンドを実行する、**Then** 500件の蔵書データがデータベースに投入される
2. **Given** ランダムデータ生成後、**When** データベースを確認する、**Then** 各データは有効なISBN形式を持つ

---

### Edge Cases

- 既にデータが存在するデータベースに対してシードを実行した場合 → 追加動作（重複ISBNはスキップ）
- CSVファイルに必須項目が欠落している行がある場合 → 該当行をスキップし、エラーレポートに記録
- 文字エンコーディングがUTF-8以外のファイルを処理する場合
- 非常に大きなファイル（数万件）をインポートする場合のメモリ・時間制限

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは、コマンド一つで事前定義されたサンプル蔵書データを投入できなければならない
- **FR-002**: サンプルデータは最低100件以上の蔵書データを含まなければならない
- **FR-003**: サンプルデータは3種類の蔵書状態（貸出可・貸出中・予約あり）を含まなければならない
- **FR-004**: サンプルデータは日本語のタイトル・著者名を含まなければならない
- **FR-005**: 全ての蔵書データは有効なISBN-13形式を持たなければならない
- **FR-006**: システムはCSVファイルからデータをインポートできなければならない
- **FR-007**: インポート時にデータの妥当性を検証し、不正な行はスキップして有効な行のみ投入し、処理完了後にスキップした行番号とエラー内容を報告しなければならない
- **FR-008**: システムは指定件数のランダムなテストデータを生成できなければならない
- **FR-009**: 既存データがある場合のシード実行時は、データを追加する形で動作しなければならない

### Key Entities

- **蔵書（Book）**: タイトル、著者、ISBN、出版社、出版年、ジャンル、状態を持つ書籍情報
- **蔵書状態**: 貸出可（available）、貸出中（borrowed）、予約あり（reserved）の3種類

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 開発者がコマンド1回の実行で100件以上のサンプルデータを投入できる
- **SC-002**: シードデータ投入後、蔵書検索機能で投入したデータが正しく検索できる
- **SC-003**: CSVインポート時、1000件のデータを1分以内に処理できる
- **SC-004**: 投入されたデータの100%が有効なISBN-13形式を持つ
- **SC-005**: サンプルデータの蔵書状態が3種類（貸出可・貸出中・予約あり）にバランスよく分布している

## Clarifications

### Session 2025-12-24

- Q: CSVインポート時の不正データ処理方針は？ → A: 不正行スキップ・継続（不正行をスキップし、有効な行のみ投入。最後にスキップした行番号とエラー内容を報告）

## Assumptions

- CSVファイルの文字エンコーディングはUTF-8を標準とする
- ISBN-13形式はハイフンなしの13桁数字とする
- サンプルデータには日本の古典文学作品を中心に含める
- シードコマンドは開発環境・テスト環境でのみ使用されることを想定
- 既存データがある場合は追加動作とし、重複ISBNはスキップする
