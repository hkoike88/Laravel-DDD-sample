# Feature Specification: 蔵書検索画面

**Feature Branch**: `004-book-search-ui`
**Created**: 2025-12-24
**Status**: Draft
**Input**: User description: "図書館職員として、蔵書を検索する画面を使いたい。タイトルや著者名で素早く蔵書を探し、貸出可能かどうかを確認したいからだ。"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - キーワード検索と結果表示 (Priority: P1)

図書館職員として、タイトルまたは著者名を入力して蔵書を検索し、検索結果を一覧で確認したい。

**Why this priority**: 蔵書検索の最も基本的かつ頻繁に使用される機能。これがなければ他の機能が意味をなさない。

**Independent Test**: 検索フォームにキーワードを入力し、検索ボタンをクリックすると、該当する蔵書が一覧表示されることを確認できる。

**Acceptance Scenarios**:

1. **Given** 検索画面が表示されている, **When** タイトル欄に「猫」と入力して検索ボタンをクリック, **Then** タイトルに「猫」を含む蔵書が一覧表示される
2. **Given** 検索画面が表示されている, **When** 著者欄に「夏目」と入力して検索ボタンをクリック, **Then** 著者名に「夏目」を含む蔵書が一覧表示される
3. **Given** 検索画面が表示されている, **When** タイトルと著者の両方に値を入力して検索, **Then** 両方の条件を満たす蔵書のみが表示される
4. **Given** 検索を実行中, **When** API呼び出し中, **Then** ローディング表示が表示される

---

### User Story 2 - 蔵書状態の視覚的確認 (Priority: P1)

図書館職員として、検索結果で各蔵書の貸出状態を一目で確認したい。

**Why this priority**: 蔵書の貸出可否を即座に判断できることは、窓口業務の効率化に直結する重要機能。

**Independent Test**: 検索結果で各蔵書の状態が色分けされたバッジで表示され、貸出可能かどうかが一目でわかることを確認できる。

**Acceptance Scenarios**:

1. **Given** 検索結果に貸出可能な蔵書がある, **When** 結果を表示, **Then** その蔵書は緑色のバッジで「貸出可」と表示される
2. **Given** 検索結果に貸出中の蔵書がある, **When** 結果を表示, **Then** その蔵書は赤色のバッジで「貸出中」と表示される
3. **Given** 検索結果に予約ありの蔵書がある, **When** 結果を表示, **Then** その蔵書は黄色のバッジで「予約あり」と表示される

---

### User Story 3 - ISBN検索 (Priority: P2)

図書館職員として、ISBNを入力して特定の蔵書を正確に検索したい。

**Why this priority**: キーワード検索よりも利用頻度は低いが、特定の蔵書を確実に検索する際に必要。

**Independent Test**: ISBN欄に有効なISBNを入力して検索すると、該当する蔵書のみが表示されることを確認できる。

**Acceptance Scenarios**:

1. **Given** 検索画面が表示されている, **When** ISBN欄に「9784003101018」と入力して検索, **Then** 該当するISBNの蔵書のみが表示される
2. **Given** 検索画面が表示されている, **When** 存在しないISBNで検索, **Then** 「該当する蔵書が見つかりませんでした」と表示される

---

### User Story 4 - ページネーション (Priority: P2)

図書館職員として、検索結果が多い場合でもページ分割で閲覧したい。

**Why this priority**: 大量の検索結果を効率的に閲覧するために必要だが、基本検索機能の後に実装可能。

**Independent Test**: 検索結果が複数ページにまたがる場合、ページ番号をクリックして他のページの結果を表示できることを確認できる。

**Acceptance Scenarios**:

1. **Given** 検索結果が100件ある, **When** 結果を表示, **Then** 1ページに20件が表示され、ページネーションが表示される
2. **Given** ページネーションが表示されている, **When** ページ2をクリック, **Then** 21〜40件目の結果が表示される
3. **Given** 最初のページを表示中, **When** 「次へ」をクリック, **Then** 次のページの結果が表示される

---

### User Story 5 - 検索結果なし時のフィードバック (Priority: P2)

図書館職員として、検索結果が0件の場合に適切なメッセージを確認したい。

**Why this priority**: ユーザー体験向上のために必要だが、コア機能ではない。

**Independent Test**: 該当する蔵書がない検索条件で検索すると、適切なメッセージが表示されることを確認できる。

**Acceptance Scenarios**:

1. **Given** 検索画面が表示されている, **When** 存在しないタイトルで検索, **Then** 「検索条件に一致する蔵書が見つかりませんでした」と表示される
2. **Given** 検索結果が0件, **When** 結果画面を表示, **Then** 検索条件の変更を促すヒントが表示される

---

### Edge Cases

- 検索中にネットワークエラーが発生した場合、エラーメッセージを表示し再試行を促す
- 検索条件を入力せずに検索ボタンをクリックした場合、全件検索として扱う
- 非常に長い検索キーワード（256文字以上）が入力された場合、バリデーションエラーを表示する
- APIからのレスポンスが遅延した場合（5秒以上）、タイムアウトメッセージを表示する

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 画面に検索条件入力フォームを表示しなければならない（タイトル、著者名、ISBN）
- **FR-002**: 検索ボタンをクリックすると蔵書検索APIを呼び出さなければならない
- **FR-003**: 検索結果をテーブル形式で表示しなければならない（タイトル、著者、出版社、状態）
- **FR-004**: 蔵書の状態を色分けバッジで表示しなければならない（貸出可: 緑、貸出中: 赤、予約あり: 黄）
- **FR-005**: 検索結果が複数ページにわたる場合、ページネーションを表示しなければならない
- **FR-006**: 検索結果が0件の場合、適切なメッセージを表示しなければならない
- **FR-007**: API呼び出し中はローディング表示をしなければならない
- **FR-008**: APIエラー時にはユーザーフレンドリーなエラーメッセージを表示しなければならない
- **FR-009**: 1ページあたりの表示件数はデフォルト20件とする
- **FR-010**: 検索条件を入力せずに検索した場合、全件検索として処理しなければならない
- **FR-011**: タイトルと著者名の検索は部分一致、ISBNは完全一致とする
- **FR-012**: 検索結果件数を画面上部に表示しなければならない
- **FR-013**: 現在表示中の件数範囲を表示しなければならない（例：「1〜20件目 / 110件中」）

### Key Entities

- **蔵書（Book）**: 図書館が所蔵する書籍。主な属性はID、タイトル、著者、ISBN、出版社、出版年、ジャンル、状態
- **蔵書状態（BookStatus）**: 蔵書の貸出状態。貸出可（available）、貸出中（borrowed）、予約あり（reserved）

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 職員が検索条件を入力してから結果が表示されるまで3秒以内
- **SC-002**: 検索結果の状態バッジを見て蔵書の貸出可否を判断できる確率95%以上
- **SC-003**: ページネーションを使用して目的の蔵書を見つけられる成功率90%以上
- **SC-004**: 初めて使用する職員でも説明なしに検索操作を完了できる
- **SC-005**: 検索結果0件時のメッセージを見て次のアクションを理解できる

## Assumptions

- 蔵書検索API（GET /api/books）は既に実装済み（003-book-search-api）
- 認証は不要（図書館内部システムとして認証なしでアクセス可能）
- 対応ブラウザはモダンブラウザ（Chrome、Firefox、Edge、Safari最新版）
- 画面はデスクトップ向けレイアウトを優先（レスポンシブ対応は後続タスク）

## Out of Scope

- 蔵書詳細モーダル（後続ストーリーで実装）
- 蔵書の貸出・返却操作
- 検索条件の保存・履歴機能
- モバイル対応（レスポンシブデザイン）
- 多言語対応
