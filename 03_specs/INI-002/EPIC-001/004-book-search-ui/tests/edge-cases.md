# エッジケーステストケース: 蔵書検索画面

**Feature**: 004-book-search-ui
**Created**: 2025-12-24
**Type**: エッジケース（Edge Cases）

---

## 入力値の境界条件

### TC-EC001: 最大文字数入力（タイトル）

**前提条件**: 検索画面（/books）が表示されている

| Step | Action | Expected Result |
|------|--------|-----------------|
| 1 | タイトル欄に255文字の文字列を入力 | 入力が受け付けられる |
| 2 | 検索ボタンをクリック | 検索が正常に実行される |

**検証項目**:
- [ ] 255文字まで入力可能
- [ ] 検索が正常に動作する

**テストデータ**:
```
あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやゆよらりるれろわをんあいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやゆよらりるれろわをんあいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやゆよらりるれろわをんあいうえおかきくけこ...
```

---

### TC-EC002: 最大文字数超過（タイトル）

**前提条件**: 検索画面（/books）が表示されている

| Step | Action | Expected Result |
|------|--------|-----------------|
| 1 | タイトル欄に256文字以上の文字列を入力 | バリデーションエラーが表示される |

**検証項目**:
- [ ] 入力が制限されるか、バリデーションエラーが表示される
- [ ] APIにリクエストが送信されない（クライアント側バリデーション）

---

### TC-EC003: 空白のみの入力

**前提条件**: 検索画面（/books）が表示されている

| Step | Action | Expected Result |
|------|--------|-----------------|
| 1 | タイトル欄に「   」（スペースのみ）を入力 | 入力が表示される |
| 2 | 検索ボタンをクリック | 空白がトリムされ、全件検索として実行される |

**検証項目**:
- [ ] 空白のみは検索条件として扱われない
- [ ] 全件検索と同様の結果になる

---

### TC-EC004: 特殊文字を含む検索

**前提条件**: 検索画面（/books）が表示されている

| Step | Action | Expected Result |
|------|--------|-----------------|
| 1 | タイトル欄に「<script>alert(1)</script>」と入力 | 入力が表示される（XSSとして実行されない） |
| 2 | 検索ボタンをクリック | 検索が実行される（SQLインジェクション攻撃にならない） |

**検証項目**:
- [ ] XSS攻撃が防止される（スクリプトが実行されない）
- [ ] 特殊文字が正しくエスケープされる
- [ ] 画面が壊れない

**テストデータ**:
```
<script>alert('XSS')</script>
"; DROP TABLE books; --
' OR '1'='1
```

---

### TC-EC005: 日本語・英語・記号混在入力

**前提条件**: 検索画面（/books）が表示されている

| Step | Action | Expected Result |
|------|--------|-----------------|
| 1 | タイトル欄に「吾輩は Cat-123 である！」と入力 | 入力が正しく表示される |
| 2 | 検索ボタンをクリック | 検索が正常に実行される |

**検証項目**:
- [ ] マルチバイト文字が正しく処理される
- [ ] 記号が検索条件として機能する

---

### TC-EC006: 絵文字入力

**前提条件**: 検索画面（/books）が表示されている

| Step | Action | Expected Result |
|------|--------|-----------------|
| 1 | タイトル欄に「📚本の検索」と入力 | 入力が表示される |
| 2 | 検索ボタンをクリック | 検索が実行される（エラーにならない） |

**検証項目**:
- [ ] 絵文字を含む入力でエラーにならない
- [ ] 文字化けしない

---

## ISBN入力の境界条件

### TC-EC007: ISBN-13形式（ハイフンあり）

**前提条件**: 検索画面（/books）が表示されている

| Step | Action | Expected Result |
|------|--------|-----------------|
| 1 | ISBN欄に「978-4-00-310101-8」と入力 | 入力が表示される |
| 2 | 検索ボタンをクリック | ハイフンが除去されて検索される、または許容される |

**検証項目**:
- [ ] ハイフン付きISBNが処理される
- [ ] 正しい蔵書が検索される

---

### TC-EC008: ISBN-10形式

**前提条件**: 検索画面（/books）が表示されている

| Step | Action | Expected Result |
|------|--------|-----------------|
| 1 | ISBN欄に「4003101014」と入力 | 入力が表示される |
| 2 | 検索ボタンをクリック | 10桁ISBNでも検索可能 |

**検証項目**:
- [ ] 10桁と13桁の両方に対応

---

### TC-EC009: 無効なISBN形式

**前提条件**: 検索画面（/books）が表示されている

| Step | Action | Expected Result |
|------|--------|-----------------|
| 1 | ISBN欄に「1234」と入力 | 入力が表示される |
| 2 | 検索ボタンをクリック | バリデーションエラーまたは0件結果 |

**検証項目**:
- [ ] 不正なISBN形式に対する適切なハンドリング

**テストデータ**:
```
1234          # 桁数不足
12345678901234 # 桁数超過
ABCDEFGHIJK   # 数字以外
```

---

## ページネーションの境界条件

### TC-EC010: 最初のページで「前へ」クリック

**前提条件**: 1ページ目を表示中

| Step | Action | Expected Result |
|------|--------|-----------------|
| 1 | 「前へ」ボタンを確認 | ボタンが無効化（disabled）されている |

**検証項目**:
- [ ] 1ページ目では「前へ」がクリックできない
- [ ] ボタンがグレーアウトまたは非表示

---

### TC-EC011: 最後のページで「次へ」クリック

**前提条件**: 最終ページを表示中

| Step | Action | Expected Result |
|------|--------|-----------------|
| 1 | 「次へ」ボタンを確認 | ボタンが無効化（disabled）されている |

**検証項目**:
- [ ] 最終ページでは「次へ」がクリックできない
- [ ] ボタンがグレーアウトまたは非表示

---

### TC-EC012: 1ページのみの結果

**前提条件**: 検索結果が20件以下

| Step | Action | Expected Result |
|------|--------|-----------------|
| 1 | 結果件数が20件以下の検索を実行 | 検索結果が表示される |
| 2 | ページネーションを確認 | ページネーションが表示されない、または「1/1」と表示 |

**検証項目**:
- [ ] 単一ページでは不要なページネーションが表示されない

---

### TC-EC013: 存在しないページ番号へのアクセス

**前提条件**: 検索結果が3ページ（60件）

| Step | Action | Expected Result |
|------|--------|-----------------|
| 1 | URLパラメータでpage=100を指定 | 最終ページにリダイレクト、または適切なエラー |

**検証項目**:
- [ ] 存在しないページでエラーにならない
- [ ] 適切なフォールバック動作

---

### TC-EC014: 負のページ番号

**前提条件**: 検索画面が表示されている

| Step | Action | Expected Result |
|------|--------|-----------------|
| 1 | URLパラメータでpage=-1を指定 | 1ページ目が表示される |

**検証項目**:
- [ ] 負の値が適切に処理される
- [ ] エラーにならない

---

## 大量データの境界条件

### TC-EC015: 大量の検索結果（1000件以上）

**前提条件**: 全件検索で1000件以上の結果

| Step | Action | Expected Result |
|------|--------|-----------------|
| 1 | 全件検索を実行 | 検索結果が表示される |
| 2 | ページネーションを確認 | 適切なページ数が表示される |

**検証項目**:
- [ ] パフォーマンスが許容範囲内（3秒以内）
- [ ] ページネーションが正しく機能する
- [ ] ブラウザがフリーズしない

---

### TC-EC016: 検索結果0件

**前提条件**: 検索画面が表示されている

| Step | Action | Expected Result |
|------|--------|-----------------|
| 1 | 該当なしの検索条件で検索 | 0件メッセージが表示される |
| 2 | ページネーションを確認 | ページネーションが表示されない |

**検証項目**:
- [ ] テーブルヘッダーのみ、またはメッセージのみ表示
- [ ] 「0件」と正しく表示される

---

## 連続操作

### TC-EC017: 検索中に再度検索ボタンクリック

**前提条件**: 検索が実行中（ローディング状態）

| Step | Action | Expected Result |
|------|--------|-----------------|
| 1 | 検索ボタンをクリック | ローディング開始 |
| 2 | ローディング中に再度クリック | ボタンが無効化されており、クリックできない |

**検証項目**:
- [ ] 二重送信が防止される
- [ ] 競合状態が発生しない

---

### TC-EC018: 検索中に検索条件変更

**前提条件**: 検索が実行中（ローディング状態）

| Step | Action | Expected Result |
|------|--------|-----------------|
| 1 | 検索を開始 | ローディング表示 |
| 2 | 検索中にタイトル欄の値を変更 | 入力は可能 |
| 3 | 新しい値で再検索 | 新しい条件での検索が開始される（前の検索はキャンセル） |

**検証項目**:
- [ ] 入力フィールドは編集可能
- [ ] TanStack Queryが古いリクエストを適切にキャンセル

---

### TC-EC019: 高速連続ページ遷移

**前提条件**: 検索結果が複数ページある

| Step | Action | Expected Result |
|------|--------|-----------------|
| 1 | ページ2をクリック | ローディング開始 |
| 2 | すぐにページ3をクリック | ページ3の読み込みが開始される |
| 3 | 結果を確認 | ページ3の結果が表示される |

**検証項目**:
- [ ] 最後にクリックしたページの結果が表示される
- [ ] 中間のリクエストがキャンセルされる
- [ ] レースコンディションが発生しない

---

## ブラウザ操作

### TC-EC020: ブラウザの戻る/進む操作

**前提条件**: 検索を実行し、ページ遷移した状態

| Step | Action | Expected Result |
|------|--------|-----------------|
| 1 | ページ2に遷移 | ページ2の結果表示 |
| 2 | ブラウザの「戻る」をクリック | 前の状態に戻る |
| 3 | ブラウザの「進む」をクリック | ページ2に戻る |

**検証項目**:
- [ ] ブラウザ履歴が正しく動作する
- [ ] URLパラメータが更新される（該当する場合）

---

### TC-EC021: ページリロード

**前提条件**: 検索結果が表示されている状態

| Step | Action | Expected Result |
|------|--------|-----------------|
| 1 | F5またはリロードボタンをクリック | ページがリロードされる |
| 2 | リロード後の状態を確認 | 検索条件が保持される、または初期状態に戻る |

**検証項目**:
- [ ] リロード後にエラーが発生しない
- [ ] URLパラメータがあれば、その状態が復元される

---

## レスポンシブ・表示

### TC-EC022: 長いタイトルの表示

**前提条件**: 検索結果に非常に長いタイトルの蔵書がある

| Step | Action | Expected Result |
|------|--------|-----------------|
| 1 | 長いタイトルの蔵書を検索 | 検索結果が表示される |
| 2 | タイトル列を確認 | テキストが折り返しまたは省略される |

**検証項目**:
- [ ] レイアウトが崩れない
- [ ] テキストが適切に処理される（text-overflow: ellipsis等）

---

### TC-EC023: 長い著者名の表示

**前提条件**: 検索結果に複数の著者名を持つ蔵書がある

| Step | Action | Expected Result |
|------|--------|-----------------|
| 1 | 複数著者の蔵書を検索 | 検索結果が表示される |
| 2 | 著者列を確認 | 著者名が適切に表示される |

**検証項目**:
- [ ] 複数著者がカンマ区切り等で表示される
- [ ] レイアウトが崩れない

---

## Notes

- エッジケースは境界値分析と同値分割に基づいて設計
- セキュリティ関連のテスト（XSS、SQLインジェクション）は特に重要
- パフォーマンステストは実環境に近い条件で実施推奨
- ブラウザ固有の挙動も考慮（特にSafari）
