# Feature Specification: 蔵書登録

**Feature Branch**: `001-book-registration`
**Created**: 2026-01-06
**Status**: Draft
**Input**: EPIC-002 蔵書登録 - 職員が新規購入した図書や寄贈図書をシステムに登録する機能

## Clarifications

### Session 2026-01-06

- Q: 蔵書の追加属性（出版社・出版年）は必要か？ → A: 出版社と出版年を追加（任意項目として）
- Q: 登録後の編集機能はスコープに含まれるか？ → A: 編集・削除は別フィーチャー（本機能は登録のみ）
- Q: ISBN重複チェックのタイミングは？ → A: ISBN入力完了時にリアルタイムチェック（フォーカス移動時）

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 基本的な蔵書登録 (Priority: P1)

職員として、新規購入した図書の基本情報（タイトル、著者、ISBN、出版社、出版年）を入力して登録したい。これにより、蔵書がシステムで管理され、利用者が検索できるようになる。

**Why this priority**: 蔵書登録の基本機能であり、この機能なしには他の機能（検索、貸出等）が成り立たない。最も基本的かつ重要な価値を提供する。

**Independent Test**: 職員が図書情報を入力し、登録ボタンを押すことで図書がシステムに保存され、検索結果に表示されることを確認できる。

**Acceptance Scenarios**:

1. **Given** 職員がログイン済みの状態で蔵書登録画面を開いている, **When** タイトル「プログラミング入門」、著者「山田太郎」、ISBN「978-4-12345678-9」を入力して登録ボタンを押す, **Then** 登録完了メッセージが表示され、登録した図書の詳細確認画面に遷移する
2. **Given** 職員が蔵書登録を完了した直後, **When** 蔵書検索画面で登録したタイトルを検索する, **Then** 登録した図書が検索結果に表示される

---

### User Story 2 - 必須項目のバリデーション (Priority: P1)

職員として、登録時にタイトルが未入力の場合はエラーメッセージを確認したい。これにより、不完全なデータの登録を防ぎ、データ品質を維持できる。

**Why this priority**: データ品質の担保はシステムの信頼性に直結するため、基本登録と同等に重要。

**Independent Test**: タイトル未入力で登録を試み、適切なエラーメッセージが表示されることを確認できる。

**Acceptance Scenarios**:

1. **Given** 職員が蔵書登録画面を開いている, **When** タイトルを入力せずに著者とISBNのみ入力して登録ボタンを押す, **Then** 「タイトルは必須です」というエラーメッセージが表示され、登録は実行されない
2. **Given** 職員が必須項目エラーを確認した, **When** タイトルを入力して再度登録ボタンを押す, **Then** 登録が正常に完了する

---

### User Story 3 - ISBN重複チェック (Priority: P2)

職員として、既に登録済みのISBNを持つ図書を登録しようとした際に警告を確認したい。これにより、同一図書の重複登録を防止し、蔵書データの正確性を保てる。

**Why this priority**: データの重複防止は重要だが、基本登録機能が動作した後に対応すべき機能。

**Independent Test**: 既存のISBNと同じ値で登録を試み、警告メッセージが表示され、職員が登録を続行するか中止するか選択できることを確認できる。

**Acceptance Scenarios**:

1. **Given** ISBN「978-4-12345678-9」の図書が既に登録されている, **When** 職員が同じISBN「978-4-12345678-9」を入力してフォーカスを移動する, **Then** 「このISBNは既に登録されています。続行しますか？」という警告メッセージがリアルタイムで表示される
2. **Given** ISBN重複の警告が表示されている, **When** 職員が「続行」を選択する, **Then** 図書が登録される（複数冊の同一図書を許可）
3. **Given** ISBN重複の警告が表示されている, **When** 職員が「中止」を選択する, **Then** 登録画面に戻り、入力内容は保持される

---

### User Story 4 - 登録内容の確認 (Priority: P2)

職員として、登録完了後に登録した図書の詳細情報を確認したい。これにより、入力ミスがないか確認できる（編集機能は別フィーチャーで提供）。

**Why this priority**: 登録後の確認は品質保証として重要だが、基本登録機能の後に実装可能。

**Independent Test**: 登録完了後に詳細画面で登録内容を確認し、入力した値と一致していることを確認できる。

**Acceptance Scenarios**:

1. **Given** 職員が図書の登録を完了した, **When** 登録完了画面が表示される, **Then** 登録したタイトル、著者、ISBN、登録日時が表示される
2. **Given** 登録完了画面が表示されている, **When** 「続けて登録」ボタンを押す, **Then** 空の登録フォームが表示される

---

### Edge Cases

- ISBNが空欄の場合、ISBNなしで登録を許可する（ISBNを持たない古書や自費出版物に対応）
- タイトルが極端に長い場合（200文字以上）、適切なエラーメッセージを表示する
- 同時に複数の職員が同じ図書を登録しようとした場合、それぞれの登録を個別に受け付ける
- ネットワークエラー発生時、入力内容を保持したまま再試行を促すメッセージを表示する

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは職員が図書情報（タイトル、著者、ISBN、出版社、出版年）を入力して蔵書として登録できること
- **FR-002**: システムはタイトルを必須項目として検証し、未入力の場合はエラーメッセージを表示すること
- **FR-003**: システムはタイトルの最大文字数を200文字に制限し、超過時にエラーメッセージを表示すること
- **FR-004**: システムは著者名の最大文字数を100文字に制限すること
- **FR-005**: システムはISBNの形式（ISBN-10またはISBN-13）を検証し、不正な形式の場合はエラーメッセージを表示すること
- **FR-006**: システムはISBNが空欄の場合も登録を許可すること（ISBNを持たない図書に対応）
- **FR-007**: システムはISBN入力完了時（フォーカス移動時）にリアルタイムで重複チェックを行い、既に同一ISBNが登録されている場合は警告メッセージを表示し、職員に続行または中止の選択を求めること
- **FR-008**: システムは登録完了後、登録内容の確認画面を表示すること
- **FR-009**: システムは登録した図書を即座に検索可能な状態にすること
- **FR-010**: システムは登録操作を実行した職員と登録日時を記録すること
- **FR-011**: システムは出版社の最大文字数を100文字に制限すること（任意項目）
- **FR-012**: システムは出版年を西暦4桁で入力可能とし、妥当な範囲（1000〜現在年+1）を検証すること（任意項目）

### Key Entities

- **蔵書（Book）**: 図書館で管理される図書。タイトル（必須）、著者、ISBN、出版社（任意）、出版年（任意）、登録日時、登録者を属性として持つ。既存の Book エンティティを使用。
- **職員（Staff）**: 蔵書登録を行う図書館職員。認証済みユーザーとして操作を実行。既存の Staff エンティティを参照。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 職員が蔵書1件を登録するのに要する時間が平均1分以内であること
- **SC-002**: 登録した図書が検索結果に表示されるまでの時間が3秒以内であること
- **SC-003**: 必須項目未入力時のエラーメッセージ表示率が100%であること
- **SC-004**: ISBN重複時の警告表示率が100%であること
- **SC-005**: 職員の95%以上が初回利用時に補助なしで蔵書登録を完了できること

## Assumptions

- EPIC-001（蔵書検索）が完了しており、Book エンティティとリポジトリが実装済み
- 職員認証機能が実装されており、認証済みの職員のみが蔵書登録機能にアクセス可能
- ISBN-10およびISBN-13の両形式をサポートする
- 複数冊の同一図書（同じISBN）の登録は許可する（図書館では同じ本を複数冊所蔵することがある）

## Dependencies

- EPIC-001（蔵書検索）: Book エンティティ、リポジトリの実装
- 職員認証機能: 登録者の識別と認可

## Out of Scope

- 蔵書情報の編集機能（別フィーチャーで実装予定）
- 蔵書の削除機能（別フィーチャーで実装予定）
- CSVやExcelからの一括インポート機能
- ISBNからの外部API連携による書誌情報自動取得
