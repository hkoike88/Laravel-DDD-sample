# Feature Specification: ログイン画面実装

**Feature Branch**: `003-login-ui`
**Created**: 2025-12-25
**Status**: Draft
**Input**: User description: "職員がメールアドレスとパスワードでシステムにログインするためのフロントエンド画面"

---

## User Scenarios & Testing *(mandatory)*

### User Story 1 - ログイン認証 (Priority: P1)

職員として、メールアドレスとパスワードを入力してログインボタンを押すと、認証が行われてダッシュボード画面に遷移したい。これにより、業務機能（蔵書登録、貸出・返却など）を利用できるようになる。

**Why this priority**: ログイン機能の最も基本的かつ必須の機能。これがなければシステムを利用できない。

**Independent Test**: ログイン画面で有効な認証情報を入力し、ログインボタンを押すことで、ダッシュボードへ遷移することを確認できる。

**Acceptance Scenarios**:

1. **Given** ログイン画面が表示されている, **When** 有効なメールアドレスとパスワードを入力してログインボタンを押す, **Then** ダッシュボード画面に遷移する
2. **Given** ログイン画面が表示されている, **When** ログインボタンを押す, **Then** ログイン処理中はローディング表示がされ、ボタンが無効化される
3. **Given** ログイン処理が成功した, **When** ダッシュボードに遷移する, **Then** ログイン状態が維持される

---

### User Story 2 - 認証エラー表示 (Priority: P1)

職員として、無効な認証情報でログインを試みた場合、わかりやすいエラーメッセージを見たい。これにより、正しい認証情報で再試行できる。

**Why this priority**: セキュリティと利便性の両立に必須。ユーザーが問題を理解して対処できる必要がある。

**Independent Test**: 無効な認証情報でログインを試み、適切なエラーメッセージが表示されることを確認できる。

**Acceptance Scenarios**:

1. **Given** ログイン画面が表示されている, **When** 存在しないメールアドレスでログインを試みる, **Then** 「メールアドレスまたはパスワードが正しくありません」というエラーメッセージが表示される
2. **Given** ログイン画面が表示されている, **When** 正しいメールアドレスと間違ったパスワードでログインを試みる, **Then** 「メールアドレスまたはパスワードが正しくありません」というエラーメッセージが表示される
3. **Given** ログイン画面が表示されている, **When** ロックされたアカウントでログインを試みる, **Then** 「アカウントがロックされています」というエラーメッセージが表示される

---

### User Story 3 - 入力バリデーション (Priority: P2)

職員として、入力フォームに不正な値を入力した場合、送信前にエラーが表示されてほしい。これにより、無駄な通信を避け、素早く修正できる。

**Why this priority**: ユーザビリティ向上のための機能。認証自体は動作するため P2。

**Independent Test**: 空欄や不正な形式のメールアドレスを入力し、即座にバリデーションエラーが表示されることを確認できる。

**Acceptance Scenarios**:

1. **Given** ログイン画面が表示されている, **When** メールアドレスを空のままログインボタンを押す, **Then** 「メールアドレスを入力してください」というエラーが表示される
2. **Given** ログイン画面が表示されている, **When** 不正な形式のメールアドレスを入力する, **Then** 「有効なメールアドレスを入力してください」というエラーが表示される
3. **Given** ログイン画面が表示されている, **When** パスワードを空のままログインボタンを押す, **Then** 「パスワードを入力してください」というエラーが表示される

---

### User Story 4 - パスワードマスク表示 (Priority: P3)

職員として、パスワード入力時に入力内容がマスク表示されてほしい。これにより、周囲から認証情報を覗き見されることを防げる。

**Why this priority**: セキュリティのための基本機能だが、他の機能が動作していれば最低限の利用は可能。

**Independent Test**: パスワード入力欄に文字を入力し、マスク表示（●や*）されることを確認できる。

**Acceptance Scenarios**:

1. **Given** ログイン画面が表示されている, **When** パスワード入力欄に文字を入力する, **Then** 入力内容がマスク表示される

---

### Edge Cases

- ネットワークエラーが発生した場合、「通信エラーが発生しました。しばらくしてから再試行してください」というメッセージが表示される
- サーバーがタイムアウトした場合、適切なエラーメッセージが表示される
- 連続してログインに失敗した場合、レート制限エラーが表示される
- ブラウザの戻るボタンでログイン画面に戻った場合の動作

---

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムはメールアドレス入力フィールドを提供すること
- **FR-002**: システムはパスワード入力フィールド（マスク表示）を提供すること
- **FR-003**: システムはログインボタンを提供すること
- **FR-004**: システムはログイン成功時にダッシュボード画面へ遷移すること
- **FR-005**: システムはログイン失敗時に適切なエラーメッセージを表示すること
- **FR-006**: システムは入力バリデーションエラーをリアルタイムで表示すること
- **FR-007**: システムはログイン処理中にローディング状態を表示すること
- **FR-008**: システムはログイン処理中にログインボタンを無効化すること
- **FR-009**: システムはメールアドレスが必須であることを検証すること
- **FR-010**: システムはメールアドレスの形式を検証すること
- **FR-011**: システムはパスワードが必須であることを検証すること
- **FR-012**: システムはアカウントロック時に専用のエラーメッセージを表示すること
- **FR-013**: システムはネットワークエラー時に適切なエラーメッセージを表示すること
- **FR-014**: システムは認証済みユーザーがログイン画面にアクセスした場合、ダッシュボードへ自動リダイレクトすること

### UI Requirements

- **UI-001**: ログイン画面は「青空市立中央図書館」のヘッダーを表示すること
- **UI-002**: ログイン画面は「図書館システム 職員ログイン」というタイトルを表示すること
- **UI-003**: エラーメッセージは入力フィールドの近くに表示されること
- **UI-004**: 認証エラーメッセージはフォーム下部のエリアに表示されること

---

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 職員がログイン操作を 30 秒以内に完了できること
- **SC-002**: 初めて利用する職員でも追加説明なしにログインできること
- **SC-003**: 入力バリデーションエラーが入力直後（1秒以内）に表示されること
- **SC-004**: ログイン成功時、3秒以内にダッシュボード画面に遷移すること
- **SC-005**: エラーメッセージが明確で、職員が次に何をすべきか理解できること
- **SC-006**: すべての画面要素がアクセシブルであること（キーボード操作可能、スクリーンリーダー対応）

---

## Assumptions

- 認証 API（POST /api/auth/login）は ST-002 で実装済み
- CSRF トークン取得（GET /sanctum/csrf-cookie）は利用可能
- ダッシュボード画面の URL パスは `/dashboard` とする
- ログイン画面の URL パスは `/login` とする
- 未認証状態で業務画面にアクセスした場合、ログイン画面にリダイレクトされる

---

## Dependencies

- ST-002: 認証 API 実装（バックエンド）
- EPIC-005: 職員認証機能

---

## Clarifications

### Session 2025-12-25

- Q: 認証済みユーザーがログイン画面にアクセスした場合の動作は？ → A: ダッシュボードへ自動リダイレクト
