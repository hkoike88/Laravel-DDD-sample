# Feature Specification: 職員アカウント作成機能

**Feature Branch**: `007-staff-account-create`
**Created**: 2026-01-06
**Status**: Draft
**Input**: User description: "02_backlog/00_epics/INI-001/EPIC-003/epic.md"

## Clarifications

### Session 2026-01-06

- Q: 職員一覧のページネーション → A: ページネーション表示（20件/ページ）
- Q: 初期パスワードの表示方法 → A: マスク表示（****）+ 表示ボタン + コピーボタン
- Q: 監査ログの記録内容 → A: 標準（操作者ID、対象職員ID、操作種別、タイムスタンプ）
- Q: 作成完了後の画面遷移フロー → A: 作成結果画面を表示し、「一覧へ戻る」ボタンで遷移

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 管理者による職員アカウント作成 (Priority: P1)

管理者は、システムに新しい職員を登録するために、職員アカウント作成画面から必要情報を入力してアカウントを作成する。作成完了後、初期パスワードを含む登録結果を確認し、職員に伝達する。

**Why this priority**: 職員がシステムを利用するための最も基本的な機能であり、他のすべての職員向け機能の前提条件となる。

**Independent Test**: 管理者としてログインし、職員作成フォームに氏名・メールアドレス・権限を入力して送信することで、新しい職員アカウントが作成され、初期パスワードが表示されることを確認できる。

**Acceptance Scenarios**:

1. **Given** 管理者がログインしている状態で職員アカウント作成画面を開いている, **When** 氏名「山田太郎」、メールアドレス「yamada@example.com」、権限「一般職員」を入力して作成ボタンを押す, **Then** 職員アカウントが作成され、初期パスワードがマスク表示（****）で画面に表示される（表示ボタンとコピーボタン付き）
2. **Given** 管理者がログインしている状態で職員アカウント作成画面を開いている, **When** 氏名「鈴木花子」、メールアドレス「suzuki@example.com」、権限「管理者」を入力して作成ボタンを押す, **Then** 管理者権限を持つ職員アカウントが作成される
3. **Given** 職員アカウントが正常に作成された, **When** 作成処理が完了する, **Then** 作成結果画面が表示され、職員情報と初期パスワードを確認できる
4. **Given** 作成結果画面を表示している, **When** 「一覧へ戻る」ボタンを押す, **Then** 職員一覧画面に遷移し、成功メッセージが表示される

---

### User Story 2 - 職員一覧の確認 (Priority: P2)

管理者は、登録済みの職員を確認するために、職員一覧画面で全職員の情報（氏名、メールアドレス、権限）をページネーション形式（20件/ページ）で確認する。

**Why this priority**: 職員の登録状況を確認し、重複登録を防ぐために必要。アカウント作成と組み合わせて使用する。

**Independent Test**: 管理者としてログインし、職員一覧画面にアクセスすることで、登録済みの職員が20件ずつページネーション表示されることを確認できる。

**Acceptance Scenarios**:

1. **Given** 管理者がログインしている, **When** 職員一覧画面にアクセスする, **Then** 登録済みの職員が20件/ページでページネーション表示される
2. **Given** 職員一覧画面を表示している, **When** 新規作成ボタンを押す, **Then** 職員アカウント作成画面に遷移する
3. **Given** 職員が21名以上登録されている, **When** 2ページ目に移動する, **Then** 21件目以降の職員が表示される

---

### User Story 3 - 入力バリデーション (Priority: P1)

管理者は、誤った情報を入力した場合、適切なエラーメッセージを受け取り、正しい情報を再入力できる。

**Why this priority**: データ品質を確保し、システムの一貫性を保つために必須の機能。

**Independent Test**: 不正な入力（空の氏名、無効なメールアドレス、既存のメールアドレス）を送信し、適切なエラーメッセージが表示されることを確認できる。

**Acceptance Scenarios**:

1. **Given** 職員アカウント作成画面を開いている, **When** 氏名を空欄のまま送信する, **Then** 「氏名は必須です」というエラーメッセージが表示される
2. **Given** 職員アカウント作成画面を開いている, **When** 無効な形式のメールアドレスを入力して送信する, **Then** 「有効なメールアドレスを入力してください」というエラーメッセージが表示される
3. **Given** 既に「tanaka@example.com」で登録された職員がいる, **When** 同じメールアドレス「tanaka@example.com」で新規職員を作成しようとする, **Then** 「このメールアドレスは既に登録されています」というエラーメッセージが表示される
4. **Given** 職員アカウント作成画面を開いている, **When** 51文字以上の氏名を入力して送信する, **Then** 「氏名は50文字以内で入力してください」というエラーメッセージが表示される

---

### Edge Cases

- 複数の管理者が同時に同じメールアドレスで職員を作成しようとした場合は？→ 先に登録された方が成功し、後からの登録はメールアドレス重複エラーとなる
- 職員作成中にセッションがタイムアウトした場合は？→ ログイン画面にリダイレクトされ、再ログイン後に作成画面からやり直す
- 初期パスワードの表示を見逃した場合は？→ 作成完了後は初期パスワードを再表示できないため、管理者がパスワードリセット機能を使用する必要がある

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは管理者のみが職員アカウント作成画面にアクセスできるように制限しなければならない
- **FR-002**: システムは氏名、メールアドレス、権限（一般職員/管理者）を入力して職員アカウントを作成できなければならない
- **FR-003**: システムは氏名を50文字以内に制限しなければならない
- **FR-004**: システムはメールアドレスを255文字以内に制限しなければならない
- **FR-005**: システムはメールアドレスの一意性を検証しなければならない
- **FR-006**: システムはセキュリティ要件を満たす16文字のランダムな初期パスワードを自動生成しなければならない
- **FR-006a**: システムは初期パスワードをマスク表示（****）で表示し、表示ボタンで平文表示、コピーボタンでクリップボードにコピーできなければならない
- **FR-007**: システムはアカウント作成成功時に作成結果画面を表示し、「一覧へ戻る」ボタンで職員一覧画面に遷移できなければならない
- **FR-008**: システムはアカウント作成操作を監査ログに記録しなければならない（記録項目：操作者ID、対象職員ID、操作種別、タイムスタンプ）
- **FR-009**: システムは管理者が職員一覧を20件/ページのページネーション形式で閲覧できるようにしなければならない
- **FR-010**: 一般職員は職員アカウント作成および職員一覧の機能にアクセスできてはならない

### Key Entities

- **職員（Staff）**: システムを利用する職員を表す。氏名、メールアドレス、権限（一般職員/管理者）、パスワードを持つ。メールアドレスはシステム内で一意。
- **権限（Role）**: 職員の役割を表す。「一般職員（staff）」または「管理者（admin）」の2種類。管理者は職員管理機能にアクセス可能。
- **監査ログ（AuditLog）**: システム操作の記録。操作者ID、対象職員ID、操作種別（アカウント作成等）、タイムスタンプを含む。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 管理者はアカウント作成を3秒以内に完了できる
- **SC-002**: 必須項目未入力やメールアドレス重複時に、ユーザーが即座に（1秒以内）エラーメッセージを確認できる
- **SC-003**: 管理者は作成完了後、初期パスワードを含む職員情報を画面上で確認できる
- **SC-004**: すべてのアカウント作成操作が監査ログに記録され、後から追跡可能である
- **SC-005**: 一般職員が職員管理機能にアクセスしようとした場合、適切な権限エラーメッセージが表示される

## Assumptions

- 管理者と一般職員の認証基盤（ログイン機能）は既に実装済みである（EPIC-001の前提条件）
- 管理メニューからの導線は既に実装済みである（EPIC-002の前提条件）
- 初期パスワードの職員への伝達方法は管理者の運用に委ねる（メール通知等の自動化は本機能のスコープ外）
- 初回ログイン時のパスワード変更強制は Phase 2 で対応する（本機能のスコープ外）
- パスワードリセット機能は別機能として実装される

## Scope Boundaries

### In Scope

- 職員アカウント作成画面（入力フォーム）
- 職員一覧画面
- 管理者権限チェック
- 入力バリデーション
- 初期パスワードの自動生成
- 監査ログへの記録

### Out of Scope

- 初期パスワードのメール通知
- 初回ログイン時のパスワード変更強制
- 職員アカウントの編集機能（EPIC-004で対応）
- 職員アカウントの無効化機能（EPIC-005で対応）
- パスワードリセット機能
