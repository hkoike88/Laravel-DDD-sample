# ADR-0002: バックエンドフレームワーク（Laravel + DDD）

## ステータス

採用

## コンテキスト

図書館デジタル化システムのバックエンド開発において、以下の要件を満たすフレームワークとアーキテクチャが必要である。

- REST API の構築が容易
- 認証・認可機能の充実
- ORM によるデータベース操作
- テストの書きやすさ
- ビジネスロジックの整理・保守性

## 決定

**Laravel 11.36** を採用し、**ドメイン駆動設計（DDD）** に基づくアーキテクチャを適用する。

### 採用理由

#### Laravel

1. **生産性の高さ**
   - Eloquent ORM、Artisan CLI、豊富なヘルパー関数
   - 認証（Sanctum）、バリデーション、ジョブキューなど標準機能が充実

2. **REST API 構築に最適**
   - API Resource によるレスポンス整形
   - FormRequest によるバリデーション分離
   - Rate Limiting、CORS 対応が標準

3. **テスト環境**
   - Pest / PHPUnit によるテストが書きやすい
   - データベーステスト用の機能（Factory、RefreshDatabase）

4. **学習リソース**
   - 日本語ドキュメント・書籍が豊富
   - コミュニティが活発

#### DDD（ドメイン駆動設計）

1. **ビジネスロジックの集約**
   - Domain 層にビジネスルールを集約し、変更の影響範囲を局所化

2. **テスト容易性**
   - Domain 層は Laravel/DB に依存しないため、高速な Unit テストが可能

3. **チーム開発**
   - ドメイン単位で分担開発が可能
   - 責務が明確で、コードレビューがしやすい

## 比較検討

### フレームワーク比較

| 項目 | Laravel | Symfony | Lumen | Slim |
|------|---------|---------|-------|------|
| 学習曲線 | 低 | 高 | 低 | 中 |
| 機能の充実度 | ◎ | ◎ | △ | △ |
| REST API 向け | ◎ | ○ | ◎ | ○ |
| エコシステム | ◎ | ○ | ○ | △ |
| 日本語情報 | ◎ | ○ | ○ | △ |

### アーキテクチャ比較

| 項目 | DDD | MVC（標準） | クリーンアーキテクチャ |
|------|-----|------------|----------------------|
| 導入コスト | 中 | 低 | 高 |
| 保守性 | ◎ | △ | ◎ |
| テスト容易性 | ◎ | △ | ◎ |
| 学習価値 | ◎ | △ | ◎ |
| Laravel との親和性 | ○ | ◎ | △ |

### 不採用理由

- **Symfony**: 学習コストが高い。Laravel で十分な機能がある
- **Lumen**: 機能が限定的。Laravel との差が縮小している
- **標準 MVC**: Controller が肥大化しやすい。ビジネスロジックの分離が困難
- **クリーンアーキテクチャ**: 層が多く、Laravel の機能を活かしにくい

## 結果

### メリット

- Laravel の便利機能を活用しつつ、ビジネスロジックを整理できる
- Domain 層は Laravel に依存しないため、将来的なフレームワーク移行も視野に入る
- 学習目的として、DDD の概念を実践的に学べる

### デメリット

- 標準 MVC より初期コストが高い
- Eloquent Model と Domain Model の変換コストが発生

### リスクと対策

| リスク | 対策 |
|--------|------|
| 過剰な抽象化 | 必要最小限の DDD 構成に留める（戦術的 DDD） |
| 学習コスト | 実装パターンのサンプルコードを用意 |
| パフォーマンス | N+1 問題などは Eager Loading で対処 |

## 参考資料

- [Laravel 公式ドキュメント](https://laravel.com/docs)
- [バックエンド アーキテクチャ設計](../../99_standard/backend/01_ArchitectureDesign.md)
- [バックエンド コーディング規約](../../99_standard/backend/02_CodingStandards.md)
