# Laravel DDD ガイド

## このドキュメントについて

Laravel で DDD（ドメイン駆動設計）を実践するためのガイド。
**ドメイン別グループ化**アプローチをベースに、設計から実装までを体系的にまとめている。

---

## 対象読者

- Laravel で DDD を導入したいエンジニア
- 既存の Laravel プロジェクトを DDD に移行したい
- Domain Model と Eloquent Model の分離方法を知りたい

---

## ドキュメント構成

| ファイル | 内容 |
|----------|------|
| [00_概要.md](./00_概要.md) | 全体像・読み方ガイド（このファイル） |
| [01_アーキテクチャ設計.md](./01_アーキテクチャ設計.md) | レイヤー構成・依存関係・設計原則 |
| [02_実装パターン.md](./02_実装パターン.md) | コードサンプル集 |
| [03_ディレクトリ構成例.md](./03_ディレクトリ構成例.md) | ドメイン別グループ化の具体例 |
| [04_テスト戦略.md](./04_テスト戦略.md) | テスト構成・書き方 |
| [05_段階的移行ガイド.md](./05_段階的移行ガイド.md) | 既存プロジェクトからの移行手順 |

---

## 読み方ガイド

### 初めて DDD を学ぶ場合

```
00_概要 → 01_アーキテクチャ設計 → 02_実装パターン → 03_ディレクトリ構成例
```

### 既存プロジェクトを移行したい場合

```
00_概要 → 05_段階的移行ガイド → 02_実装パターン
```

### テストの書き方を知りたい場合

```
04_テスト戦略
```

---

## DDD とは

### 一言で言うと

> **ビジネスロジック（ドメイン）を設計の中心に据える**設計思想

### なぜ DDD か

| 問題 | DDD による解決 |
|------|---------------|
| ビジネスロジックが散らばる | Domain Model に集約 |
| テストが DB 依存で遅い | Domain は DB を知らない |
| 変更の影響範囲が広い | レイヤー分離で局所化 |
| 仕様が読みにくい | ドメイン言語がコードに反映 |

---

## 採用するアプローチ: ドメイン別グループ化

### なぜドメイン別グループ化か

| 観点 | ドメイン別グループ化 | クリーンアーキテクチャ |
|------|---------------------|----------------------|
| DDDの思想への忠実さ | ◎ | ○ |
| 学習コスト | 低〜中 | 高 |
| ファイル数 | 中程度 | 多い |
| チーム分割 | ドメイン単位で容易 | レイヤー横断で調整必要 |
| Laravel らしさ | 残せる | 薄れる |

> 詳細な比較は [アーキテクチャ比較](../アーキテクチャ比較_ドメイン別vsクリーンアーキテクチャ.md) を参照

### 構造の概要

```
packages/
├── {BoundedContext}/          # 境界づけられたコンテキスト
│   └── {Domain}/              # ドメイン
│       ├── Domain/            # ビジネスロジック
│       ├── Application/       # ユースケース
│       ├── Presentation/      # HTTP / CLI
│       └── Infrastructure/    # Eloquent / 外部サービス
└── Common/                    # 共有リソース
```

---

## 用語整理

| 用語 | 意味 |
|------|------|
| **Domain Model** | ビジネスロジックを表現するモデル（Eloquent ではない） |
| **Eloquent Model** | DB テーブルをマッピングする Laravel のモデル |
| **Repository** | Domain と Infrastructure の橋渡し |
| **UseCase** | アプリケーションのユースケース（業務フロー） |
| **DTO** | レイヤー間のデータ転送オブジェクト |
| **ValueObject** | 値で識別される不変オブジェクト |
| **Entity** | ID で識別されるオブジェクト |
| **Aggregate** | 整合性の単位となるエンティティの集合 |
| **Bounded Context** | 同じ言葉が同じ意味を持つ範囲（境界づけられたコンテキスト） |

---

## 境界づけられたコンテキストとは

### 一言で言うと

> **同じ言葉が同じ意味を持つ範囲**

### 具体例: EC サイト

「ユーザー」という言葉を考えてみる。

| コンテキスト | 「ユーザー」の意味 | 関心事 |
|-------------|------------------|--------|
| **販売（Agenda）** | 購入者 | 注文履歴、配送先、ポイント |
| **認証（Auth）** | ログインアカウント | メールアドレス、パスワード、権限 |
| **サポート** | 問い合わせ者 | チケット履歴、対応状況 |

同じ「ユーザー」でも、文脈によって**意味も持つべき情報も異なる**。

### なぜ分けるのか

```
✗ Bad: 1つの巨大な User モデル
┌─────────────────────────────────────┐
│ User                                │
│ - id, name, email, password         │
│ - shipping_address, points          │  ← 肥大化
│ - role, permissions                 │
│ - support_tickets                   │
└─────────────────────────────────────┘

✓ Good: コンテキストごとに分離
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│ Agenda/User  │  │ Auth/User    │  │ Support/User │
│ - 注文関連   │  │ - 認証関連   │  │ - サポート関連│
└──────────────┘  └──────────────┘  └──────────────┘
```

### ディレクトリ構成での表現

```
packages/
├── Agenda/                 # 境界づけられたコンテキスト①（販売業務）
│   ├── User/               # ドメイン: 購入者としてのユーザー
│   ├── Order/              # ドメイン: 注文
│   └── Product/            # ドメイン: 商品
│
├── Auth/                   # 境界づけられたコンテキスト②（認証）
│   └── User/               # ドメイン: 認証アカウントとしてのユーザー
│
└── Support/                # 境界づけられたコンテキスト③（サポート）
    └── Ticket/             # ドメイン: 問い合わせ
```

### 小規模プロジェクトの場合

コンテキストが 1 つしかない場合は、省略しても OK。

```
packages/
├── Domain/         # コンテキスト層（単一の場合は "Domain" など汎用名でも可）
│   ├── Order/
│   ├── Product/
│   └── ...
└── Common/
```

プロジェクトが大きくなったら、後からコンテキストを導入できる。

---

## Laravel の Model と DDD の Model

| 用語 | 意味 |
|------|------|
| Laravel の Model | Eloquent Model（Active Record） |
| DDD の Model | Domain Model（概念・ルール） |

> 同じ「Model」という言葉でも、責務はまったく異なる。
> このガイドでは明確に区別する。

---

## このガイドで扱わないこと

- クリーンアーキテクチャの詳細（比較資料は別途あり）
- マイクロサービス化
- CQRS / Event Sourcing の詳細
- Kubernetes / Docker 構成

---

## 参照リポジトリ

| リポジトリ | 特徴 |
|-----------|------|
| [Orphail/laravel-ddd](https://github.com/Orphail/laravel-ddd) | ドメイン別グループ化の実装例 |
| [take-t14/laravel-ddd-sample](https://github.com/take-t14/laravel-ddd-sample) | クリーンアーキテクチャの実装例（比較用） |

---

## 次のステップ

[01_アーキテクチャ設計.md](./01_アーキテクチャ設計.md) に進む
