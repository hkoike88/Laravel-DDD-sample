# インシデント対応手順

## 概要

本ドキュメントは、セキュリティインシデント発生時の対応手順を定義する。
迅速かつ適切な対応により、被害の最小化と再発防止を図る。

**Last updated:** 2025-12-26

---

## 目次

- [インシデントの定義と分類](#インシデントの定義と分類)
- [対応体制](#対応体制)
- [対応フロー](#対応フロー)
- [初動対応チェックリスト](#初動対応チェックリスト)
- [証拠保全](#証拠保全)
- [コミュニケーション](#コミュニケーション)
- [復旧手順](#復旧手順)
- [事後分析](#事後分析)
- [訓練・演習](#訓練演習)

---

## インシデントの定義と分類

### セキュリティインシデントの定義

以下の事象をセキュリティインシデントとして扱う：

- 不正アクセス（認証の突破、権限昇格）
- 情報漏洩（個人情報、機密情報の流出）
- マルウェア感染
- サービス妨害（DoS/DDoS攻撃）
- 内部不正（従業員による不正行為）
- データ改ざん
- システムの脆弱性を悪用した攻撃

### 重大度レベル

| レベル | 名称 | 定義 | 対応時間 |
|:------:|------|------|----------|
| **P1** | Critical | サービス全停止、大規模情報漏洩、法的対応が必要 | **即時**（15分以内に初動開始） |
| **P2** | High | 一部サービス停止、限定的な情報漏洩、重要機能への影響 | **1時間以内** |
| **P3** | Medium | パフォーマンス低下、軽微な情報露出、攻撃の試行検知 | **4時間以内** |
| **P4** | Low | 潜在的リスク、ポリシー違反、セキュリティ警告 | **24時間以内** |

### インシデント分類

| カテゴリ | 例 | 初期重大度 |
|---------|-----|:----------:|
| 認証・認可 | 不正ログイン、アカウント乗っ取り | P2 |
| データ漏洩 | 個人情報流出、機密データ露出 | P1-P2 |
| マルウェア | ランサムウェア、バックドア | P1 |
| 可用性 | DDoS攻撃、サービス停止 | P1-P2 |
| ウェブ攻撃 | SQLi、XSS、CSRF の成功 | P2-P3 |
| 内部不正 | 権限濫用、情報持ち出し | P1-P2 |
| 設定ミス | 認証バイパス可能な設定 | P2-P3 |

---

## 対応体制

### インシデント対応チーム（IRT）

| 役割 | 責任 | 担当者 |
|------|------|--------|
| **インシデントマネージャー** | 全体統括、意思決定、エスカレーション判断 | TBD |
| **技術リード** | 技術的な調査・対応の指揮 | TBD |
| **インフラ担当** | サーバー、ネットワークの調査・対応 | TBD |
| **アプリケーション担当** | アプリケーションレベルの調査・対応 | TBD |
| **コミュニケーション担当** | 社内外への連絡、広報対応 | TBD |
| **法務担当** | 法的対応、規制当局への報告 | TBD |

### 連絡先一覧

| 役割 | 連絡先 | 備考 |
|------|--------|------|
| セキュリティ責任者 | security@example.com | 24時間対応 |
| インフラチーム | infra@example.com | 営業時間内 |
| 緊急連絡先（オンコール） | +81-XXX-XXXX-XXXX | 24時間対応 |
| 法務部門 | legal@example.com | 営業時間内 |
| 広報部門 | pr@example.com | 営業時間内 |

### エスカレーションマトリクス

```
P4: 技術担当者 → 技術リード
P3: 技術リード → インシデントマネージャー
P2: インシデントマネージャー → CTO/CISO
P1: CTO/CISO → 経営層 → 外部機関（必要に応じて）
```

---

## 対応フロー

### 全体フロー

```
┌─────────────┐
│  1. 検知    │ ← 監視アラート、ユーザー報告、外部通報
└─────┬───────┘
      ↓
┌─────────────┐
│  2. 初動対応 │ ← 影響範囲特定、被害拡大防止
└─────┬───────┘
      ↓
┌─────────────┐
│  3. 調査    │ ← 原因特定、侵入経路分析
└─────┬───────┘
      ↓
┌─────────────┐
│  4. 封じ込め │ ← 脅威の隔離、アクセス遮断
└─────┬───────┘
      ↓
┌─────────────┐
│  5. 根絶    │ ← 脆弱性修正、マルウェア除去
└─────┬───────┘
      ↓
┌─────────────┐
│  6. 復旧    │ ← サービス再開、監視強化
└─────┬───────┘
      ↓
┌─────────────┐
│  7. 事後分析 │ ← ポストモーテム、再発防止策
└─────────────┘
```

### 各フェーズの詳細

#### 1. 検知フェーズ

**検知源**
- 監視システムのアラート（APM、SIEM、WAF）
- セキュリティスキャン結果
- ユーザーからの報告
- 外部機関（JPCERT/CC等）からの通報
- 内部監査・レビュー

**実施事項**
- インシデントの記録開始（チケット作成）
- 重大度の初期判定
- 適切な担当者への通知

#### 2. 初動対応フェーズ

**目標**: 被害拡大の防止

**実施事項**
- 影響範囲の特定
- 証拠の保全開始
- 必要に応じてサービスの一時停止判断
- 関係者への初期連絡

#### 3. 調査フェーズ

**目標**: 原因と侵入経路の特定

**実施事項**
- ログ分析（アクセスログ、認証ログ、アプリケーションログ）
- 侵入経路の特定
- 影響を受けたデータ・システムの特定
- タイムラインの作成

#### 4. 封じ込めフェーズ

**目標**: 脅威の隔離

**実施事項**
- 侵害されたアカウントの無効化
- 悪意あるIPアドレスのブロック
- 感染システムのネットワーク隔離
- 一時的なアクセス制限の実施

#### 5. 根絶フェーズ

**目標**: 脅威の完全な除去

**実施事項**
- 脆弱性の修正（パッチ適用）
- マルウェアの除去
- 不正なアカウント・バックドアの削除
- 設定の修正

#### 6. 復旧フェーズ

**目標**: 通常運用への復帰

**実施事項**
- システムの再構築（必要に応じて）
- サービスの段階的な再開
- 監視の強化
- 利用者への通知

#### 7. 事後分析フェーズ

**目標**: 再発防止と改善

**実施事項**
- ポストモーテムの実施
- 報告書の作成
- 再発防止策の策定と実施
- プロセス・ドキュメントの更新

---

## 初動対応チェックリスト

### 即時対応（15分以内）

- [ ] インシデント管理チケットを作成
- [ ] 重大度レベルを判定
- [ ] インシデントマネージャーに連絡
- [ ] 対応チームを招集
- [ ] 証拠保全を開始（ログの保護）

### 1時間以内

- [ ] 影響範囲を特定
- [ ] 被害拡大防止措置を実施
- [ ] 関係者への初期報告
- [ ] 調査用の作業環境を準備
- [ ] タイムラインの記録を開始

### 4時間以内

- [ ] 詳細な調査を実施
- [ ] 侵入経路を特定
- [ ] 封じ込め措置を完了
- [ ] 経営層への状況報告（P1/P2の場合）
- [ ] 外部報告の必要性を判断

---

## 証拠保全

### 保全対象

| 対象 | 保全方法 | 保持期間 |
|------|----------|----------|
| アクセスログ | ログサーバーへのコピー、改ざん検知ハッシュ取得 | 1年以上 |
| 認証ログ | 同上 | 1年以上 |
| アプリケーションログ | 同上 | 1年以上 |
| システムスナップショット | VM/コンテナのスナップショット取得 | 調査完了まで |
| ネットワークキャプチャ | pcap形式で保存 | 調査完了まで |
| メモリダンプ | 揮発性データの取得（必要時） | 調査完了まで |

### 証拠保全手順

```bash
# 1. ログのコピーと保護
cp -r /var/log/application /evidence/incident-YYYY-MM-DD/
chmod 400 /evidence/incident-YYYY-MM-DD/*

# 2. ハッシュ値の取得（改ざん検知用）
sha256sum /evidence/incident-YYYY-MM-DD/* > /evidence/incident-YYYY-MM-DD/checksums.sha256

# 3. タイムスタンプの記録
date -u > /evidence/incident-YYYY-MM-DD/collection_time.txt

# 4. システム情報の取得
uname -a > /evidence/incident-YYYY-MM-DD/system_info.txt
ps aux > /evidence/incident-YYYY-MM-DD/processes.txt
netstat -an > /evidence/incident-YYYY-MM-DD/network.txt
```

### 証拠の取り扱い

- 証拠のオリジナルには触れない（コピーで作業）
- すべての操作を記録（Chain of Custody）
- アクセス権限を最小限に制限
- 法的手続きに備えて保全

---

## コミュニケーション

### 内部コミュニケーション

| 対象 | タイミング | 内容 |
|------|-----------|------|
| 対応チーム | リアルタイム | 技術的な詳細、対応状況 |
| 経営層 | 1時間ごと（P1/P2） | 影響、対応状況、必要な判断事項 |
| 全社員 | 必要に応じて | サービス停止の通知、注意喚起 |

### 外部コミュニケーション

| 対象 | 条件 | 担当 |
|------|------|------|
| 利用者 | 情報漏洩が確認された場合 | コミュニケーション担当 |
| 規制当局 | 個人情報漏洩の場合（個人情報保護委員会） | 法務担当 |
| 警察 | 犯罪が疑われる場合 | 法務担当 |
| JPCERT/CC | 重大なセキュリティインシデント | セキュリティ責任者 |

### コミュニケーションテンプレート

#### 利用者向け通知（情報漏洩の場合）

```
件名: 【重要】セキュリティインシデントに関するお知らせ

[サービス名]をご利用いただきありがとうございます。

このたび、弊社サービスにおいてセキュリティインシデントが発生し、
お客様の情報が漏洩した可能性があることが判明いたしました。

■ 発生日時
YYYY年MM月DD日 HH:MM頃

■ 漏洩した可能性のある情報
- [具体的な項目]

■ 原因
[概要]

■ 対応状況
[実施した対策]

■ お客様へのお願い
[パスワード変更等の推奨事項]

■ お問い合わせ窓口
[連絡先]

お客様にご心配とご迷惑をおかけしますことを深くお詫び申し上げます。
```

---

## 復旧手順

### 復旧判断基準

以下のすべてを満たした場合に復旧を開始：

- [ ] 脅威が完全に除去されたことを確認
- [ ] 脆弱性が修正されたことを確認
- [ ] バックドア・不正アカウントが存在しないことを確認
- [ ] 監視体制が強化されていることを確認

### 復旧手順

1. **テスト環境での確認**
   - 修正後のシステムをテスト環境で検証
   - セキュリティスキャンの実施

2. **段階的な復旧**
   - 内部ユーザーのみでテスト運用
   - 監視を強化した状態で一部ユーザーに開放
   - 問題がなければ全面復旧

3. **復旧後の監視**
   - 通常の2倍の頻度で監視
   - 異常検知の閾値を一時的に厳格化
   - 1週間は注意深く観察

---

## 事後分析

### ポストモーテム実施要件

以下のインシデントはポストモーテム必須：

- 重大度 P1, P2 のインシデント
- 情報漏洩が発生したインシデント
- サービス停止が発生したインシデント
- 再発したインシデント

### ポストモーテムテンプレート

```markdown
# インシデント ポストモーテム

## 概要
- **インシデントID**: INC-YYYY-MMDD-XXX
- **発生日時**: YYYY-MM-DD HH:MM - HH:MM
- **重大度**: P1/P2/P3/P4
- **影響**: [影響を受けたユーザー数、データ量等]

## タイムライン
| 時刻 | イベント |
|------|---------|
| HH:MM | [発生/検知/対応の詳細] |

## 根本原因
[5 Whys 分析等で特定した根本原因]

## 影響
- 影響を受けたユーザー: X名
- 影響を受けたデータ: [詳細]
- ダウンタイム: X時間

## 対応の評価
### うまくいったこと
- [良かった点]

### 改善が必要なこと
- [課題点]

## 再発防止策
| 対策 | 担当 | 期限 | ステータス |
|------|------|------|-----------|
| [具体的な対策] | [担当者] | YYYY-MM-DD | 未着手/進行中/完了 |

## 教訓
[今後に活かすべき学び]
```

### 再発防止策の追跡

- すべての再発防止策をチケット化
- 週次で進捗を確認
- 完了まで追跡

---

## 訓練・演習

### 訓練計画

| 訓練種類 | 頻度 | 対象 |
|---------|------|------|
| 机上演習（Tabletop） | 四半期ごと | IRT全員 |
| 技術演習 | 半年ごと | 技術担当 |
| 全社訓練 | 年1回 | 全従業員 |

### 演習シナリオ例

1. **ランサムウェア感染シナリオ**
   - 本番サーバーがランサムウェアに感染
   - データが暗号化され、身代金を要求される

2. **情報漏洩シナリオ**
   - 外部から顧客情報の漏洩を通報される
   - 漏洩経路と範囲を特定し、対応する

3. **DDoS攻撃シナリオ**
   - サービスが応答不能になる
   - 攻撃の緩和と復旧を行う

### 演習後のレビュー

- 対応手順の有効性を評価
- 改善点を特定
- ドキュメントを更新

---

## 関連ドキュメント

- [02_SecurityDesign.md](../backend/02_SecurityDesign.md) - セキュリティ設計標準
- [08_SecurityScanning.md](./08_SecurityScanning.md) - セキュリティスキャンガイド
- [04_LoggingDesign.md](../backend/04_LoggingDesign.md) - ログ設計標準

---

## 改訂履歴

| バージョン | 日付 | 変更内容 | 担当者 |
|-----------|------|---------|-------|
| 1.0.0 | 2025-12-26 | 初版作成 | - |
